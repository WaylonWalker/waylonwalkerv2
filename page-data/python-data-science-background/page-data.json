{"componentChunkName":"component---src-templates-blog-post-js","path":"/python-data-science-background/","result":{"data":{"markdownRemark":{"id":"6deb91dc-a585-565b-87e0-15104c44e573","html":"<p>This post is intended as an extension/update from <a href=\"https://waylonwalker.com/background-1/\">background tasks in python</a>.  I started using <code class=\"language-text\">background</code> the week that Kenneth Reitz released it.  It takes away so much boilerplate from running background tasks that I use it in more places than I probably should. After taking a look at that post today, I wanted to put a better data science example in here to help folks get started.</p>\n<blockquote>\n<p>I use it in more places than I probably should</p>\n</blockquote>\n<p>Before we get into it, I want to make a shout out to Kenneth Reitz for making this so easy.  Kenneth is a python God for all that he has given to the community in so many ways, especially with his ideas in building stupid simple api's for very complicated things.</p>\n<h2>Installation</h2>\n<h3>install via pip</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pip install background</code></pre></div>\n<h3>install via github</h3>\n<p>I believe one of the later pr's to the project fixes the way arguments are passed in.  I generally clone the repo or copy the module directly into my project.</p>\n<p><strong>clone it</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone https://github.com/ParthS007/background.git\ncd background\npython setup.py install</code></pre></div>\n<p><strong>copy the module</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl https://raw.githubusercontent.com/ParthS007/background/master/background.py &gt; background.py</code></pre></div>\n<h2>üêå The Slow Function</h2>\n<p>Imagine that this function is a big one!  This function is fairly realistic as it takes in some input and returns a DataFrame.  This is what a good half of my fuctions do in data science.  The internals of this function generally will include a sql query, load from s3 or a data catalog, an aggregation from another DataFrame.  In general it should do one simple thing.</p>\n<p><strong>Feel Free to copy this \"boilerplate\"</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> background\n<span class=\"token keyword\">from</span> time <span class=\"token keyword\">import</span> sleep\n<span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n\n<span class=\"token decorator annotation punctuation\">@background<span class=\"token punctuation\">.</span>task</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">long_func</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Simulates fetching data from a service\n    and returning a pandas DataFrame.\n\n    \"\"\"</span>\n    sleep<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'number_squared'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>i<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Calling the Slow Function</h2>\n<p><em>it's the future calling ü§ô</em></p>\n<p>If we were to call this function 10 times it would take 100s.  Not bad for a dumb example, but detrimental when this gets scaled upüí•.  We want to utilize all of our available resources to reduce our development time and get moving on our project.</p>\n<p>Calling <code class=\"language-text\">long_func</code> will return a future object.  This object has a number of methods that you can read about in the <a href=\"https://docs.python.org/3/library/concurrent.futures.html#future-objects\">cpython docs</a>.  The main one we are interested in is <code class=\"language-text\">result</code>.  I typically call these functions many times and put them into a list object so that I can track their progress and get their results.  If you needed to map inputs back to the result use a dictionary.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span>time futures <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>long_func<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\nCPU times<span class=\"token punctuation\">:</span> user <span class=\"token number\">319</span> ¬µs<span class=\"token punctuation\">,</span> sys<span class=\"token punctuation\">:</span> <span class=\"token number\">197</span> ¬µs<span class=\"token punctuation\">,</span> total<span class=\"token punctuation\">:</span> <span class=\"token number\">516</span> ¬µs\nWall time<span class=\"token punctuation\">:</span> <span class=\"token number\">212</span> ¬µs</code></pre></div>\n<h2>Do something with those <code class=\"language-text\">results()</code></h2>\n<p>Simply running the function completes in no time! This is because the future objects that are returned are non blocking and will run in a background task using the <code class=\"language-text\">ProcessPoolExecutor</code>.  To get the result back out we need to call the <code class=\"language-text\">result</code> method on the future object.<code class=\"language-text\">result</code> is a blocking function that will not realease until the function has completed.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span><span class=\"token operator\">%</span>time\nfutures <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>long_func<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\npd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>future<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> future <span class=\"token keyword\">in</span> futures<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nCPU times<span class=\"token punctuation\">:</span> user <span class=\"token number\">5.38</span> ms<span class=\"token punctuation\">,</span> sys<span class=\"token punctuation\">:</span> <span class=\"token number\">3.53</span> ms<span class=\"token punctuation\">,</span> total<span class=\"token punctuation\">:</span> <span class=\"token number\">8.9</span> ms\nWall time<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span> s</code></pre></div>\n<p>Note that this example completed in <code class=\"language-text\">10s</code>, the time it took for only one run, not all 10! üòé</p>\n<h2>n</h2>\n<p>üò´ <em>crank it up</em></p>\n<p>By default the number of parallel processes wil be equal to the number of cpu threads on your machine. To increase the number of parallel processes (<code class=\"language-text\">max_workers</code>) set increase <code class=\"language-text\">background.n</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">background<span class=\"token punctuation\">.</span>n <span class=\"token operator\">=</span> <span class=\"token number\">100</span></code></pre></div>\n<h1>Is it possible to overruse @background.task?</h1>\n<p>I use this essentially anywhere that I cannot vectorize a python operation and push the compute down into those fast üí® c extended libraries like numpy, and the operation takes more than a few minutes.  Nearly every big network request I make gets broken down into chunks and multithreaded.  Let me know... is is possible to overruse <code class=\"language-text\">@background.task</code>? Let me know your thoughts <a href=\"https://twitter.com/_WaylonWalker\">@_WaylonWalker</a>.</p>\n<h1>Repl.It</h1>\n<p>Play with the code here!  Try different values of background.n and n_runs.</p>\n<iframe height=\"800px\" width=\"100%\" src=\"https://repl.it/@WaylonWalker/TestRepl?lite=true\" scrolling=\"no\" frameborder=\"no\" allowtransparency=\"true\" allowfullscreen=\"true\" sandbox=\"allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-modals\"></iframe>","fields":{"slug":"/python-data-science-background/"},"frontmatter":{"date":"2019-09-10T05:00:00.000Z","title":"Background Tasks in Python for Data Science","description":"This post is intended as an extension/update from [background tasks in python](https://waylonwalker.com/background-1/). I started using `background` the week that Kenneth Reitz released it.  It takes away so much boilerplate from running background tasks that I use it in more places than I probably should. After taking a look at that post today, I wanted to put a better data science example in here to help folks get started.","status":"published","cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/erwan-hesry-elayN_YscVg-unsplash.jpg","xsm_img":{"fixed":{"src":"/static/71deab00d1a8618a3734aa94387173fc/2c7f8/erwan-hesry-elayN_YscVg-unsplash.jpg","srcWebp":"/static/71deab00d1a8618a3734aa94387173fc/f6b6d/erwan-hesry-elayN_YscVg-unsplash.webp"}},"sm_img":{"fixed":{"src":"/static/71deab00d1a8618a3734aa94387173fc/9dc27/erwan-hesry-elayN_YscVg-unsplash.jpg","srcWebp":"/static/71deab00d1a8618a3734aa94387173fc/403a4/erwan-hesry-elayN_YscVg-unsplash.webp"}},"med_img":{"fixed":{"src":"/static/71deab00d1a8618a3734aa94387173fc/0f3a1/erwan-hesry-elayN_YscVg-unsplash.jpg","srcWebp":"/static/71deab00d1a8618a3734aa94387173fc/e9589/erwan-hesry-elayN_YscVg-unsplash.webp"}},"full":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAa8yJAf/xAAYEAEBAAMAAAAAAAAAAAAAAAABAAIREv/aAAgBAQABBQLuc5Tf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BV//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AUf/xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEABj8CKv/EABoQAAICAwAAAAAAAAAAAAAAAAABESExgZH/2gAIAQEAAT8hSpYFxTSGpVw//9oADAMBAAIAAwAAABCEH//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EFP/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QrD//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAhUYH/2gAIAQEAAT8QSGayGtamWdtbDYDfbz//2Q==","width":1000,"height":420,"src":"/static/71deab00d1a8618a3734aa94387173fc/9cf42/erwan-hesry-elayN_YscVg-unsplash.jpg","srcSet":"/static/71deab00d1a8618a3734aa94387173fc/9cf42/erwan-hesry-elayN_YscVg-unsplash.jpg 1x"},"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAa8yJAf/xAAYEAEBAAMAAAAAAAAAAAAAAAABAAIREv/aAAgBAQABBQLuc5Tf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BV//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AUf/xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEABj8CKv/EABoQAAICAwAAAAAAAAAAAAAAAAABESExgZH/2gAIAQEAAT8hSpYFxTSGpVw//9oADAMBAAIAAwAAABCEH//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EFP/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QrD//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAhUYH/2gAIAQEAAT8QSGayGtamWdtbDYDfbz//2Q==","aspectRatio":2.380952380952381,"src":"/static/71deab00d1a8618a3734aa94387173fc/9cf42/erwan-hesry-elayN_YscVg-unsplash.jpg","srcSet":"/static/71deab00d1a8618a3734aa94387173fc/ff9d4/erwan-hesry-elayN_YscVg-unsplash.jpg 250w,\n/static/71deab00d1a8618a3734aa94387173fc/2dc04/erwan-hesry-elayN_YscVg-unsplash.jpg 500w,\n/static/71deab00d1a8618a3734aa94387173fc/9cf42/erwan-hesry-elayN_YscVg-unsplash.jpg 1000w,\n/static/71deab00d1a8618a3734aa94387173fc/48be0/erwan-hesry-elayN_YscVg-unsplash.jpg 1200w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"6deb91dc-a585-565b-87e0-15104c44e573","prev":{"id":"151d09ad-0647-585d-83c1-8fd90ca20f01","html":"<style>\n/* h2 {display: block;} */\nh2>img { margin: auto; width: 100%;}\n</style>\n<p>Python <code class=\"language-text\">*args</code> and <code class=\"language-text\">**kwargs</code> are super useful tools, that when used properly can make you code much simpler and easier to maintain.  Large manual conversions from a dataset to function arguments can be packed and unpacked into lists or dictionaries. Beware though, this power <strong>can</strong> lead to some really unreadable/unusable code if done wrong.</p>\n<h2>*args are for lists</h2>\n<p>*args are some magical syntax that will collect function arguments into a list, or unpack a list into individual arguments.</p>\n<h2><img src=\"https://waylonwalker.com/args-kwargs/1.png\" alt=\"recieving *args\" title=\"sending *args collects all arguments into a list inside of the function\"></h2>\n<p>When recieving variables as a <code class=\"language-text\">*&lt;varname&gt;</code>, commonly <code class=\"language-text\">*args</code>, the arguments get <strong>packed</strong> into an ordered list.</p>\n<blockquote>\n<p>Never add *args to your function definition (almost never)</p>\n</blockquote>\n<p>Generally I find <code class=\"language-text\">*args</code> poor naming and it only drives confusion to the user looking at your function trying to decide what exactly it does.  Here I have chosen the name <code class=\"language-text\">printrows</code> since we are printing each item as a row.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">printer</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>printrows<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> row <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>printrows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> printer<span class=\"token punctuation\">(</span><span class=\"token string\">'eggs'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'spam'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ham'</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">0</span> eggs\n<span class=\"token number\">1</span> spam\n<span class=\"token number\">2</span> ham</code></pre></div>\n<h2>Be Aware of AntiPatterns</h2>\n<p>If your <code class=\"language-text\">*args</code> collection is distictly different things, then make them separate variables.  Using <code class=\"language-text\">*args</code> as a crutch can lead to a really confusing api for your users, even yourself.</p>\n<h2>‚ùå</h2>\n<p>Here <code class=\"language-text\">*args</code> is confusing as we are a bit unsure of what to pass to <code class=\"language-text\">get_user_data</code>, or which order it needs to be in without reading the code.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_user_data</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token string\">\"does stuff given a users GitHub and DevTo username\"</span>\n  github <span class=\"token operator\">=</span> reuqests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'https://api.github.com/users/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n  devto <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'https://dev.to/api/users/by_username?url=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h2>‚úî</h2>\n<p>Here the function signature makes it clear what <code class=\"language-text\">get_user_data</code> expects.  Users will not have to read your docstring or worse your source code to understand it each time the reference it.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_user_data</span><span class=\"token punctuation\">(</span>github_username<span class=\"token punctuation\">,</span> devto_username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token string\">\"does stuff given a users GitHub and DevTo username\"</span>\n  github <span class=\"token operator\">=</span> reuqests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'https://api.github.com/users/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>github_username<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n  devto <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'https://dev.to/api/users/by_username?url=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>devto_username<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h2><img src=\"https://waylonwalker.com/args-kwargs/2.png\" alt=\"sending *args\" title=\"sending *args unpacks a list into individual arguments to be used in the function\"></h2>\n<p>Inversely we can send a list of things as individual arguments by <strong>unpacking</strong> them into the function call.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> things_to_print <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'eggs'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'spam'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ham'</span><span class=\"token punctuation\">]</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> printer<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>things_to_print<span class=\"token punctuation\">)</span>\n<span class=\"token number\">0</span> eggs\n<span class=\"token number\">1</span> spam\n<span class=\"token number\">2</span> ham</code></pre></div>\n<hr>\n<h2>**kwargs are for dictionaries</h2>\n<p>Just like <code class=\"language-text\">*args</code> being for lists, <code class=\"language-text\">**kwargs</code> are for dictionaries.  When packing them up inside of a function. The argument name passed in becomes the key, then invers happens when unpacking, the key becomes the argument for the function.</p>\n<h2><img src=\"https://waylonwalker.com/args-kwargs/3.png\" alt=\"recieving **kwargs\"></h2>\n<p>Here is a function accepting <code class=\"language-text\">**printrows</code> as it's only input. Any keyword argument that you pass into the function will get packed into a dictionary.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">printer</span><span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>printrows<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">for</span> key <span class=\"token keyword\">in</span> printrows<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> printrows<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> printer<span class=\"token punctuation\">(</span>breakfast<span class=\"token operator\">=</span><span class=\"token string\">'eggs'</span><span class=\"token punctuation\">,</span> lunch<span class=\"token operator\">=</span><span class=\"token string\">'spam'</span><span class=\"token punctuation\">,</span> dinner<span class=\"token operator\">=</span><span class=\"token string\">'ham'</span><span class=\"token punctuation\">)</span>\nbreakfast eggs\nlunch spam\ndinner ham</code></pre></div>\n<p>Any arguments passed in will throw a <code class=\"language-text\">TypeError</code>, since this <code class=\"language-text\">printer</code> does not accept any positional arguments.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span>printer<span class=\"token punctuation\">(</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>\nTypeError                                 Traceback <span class=\"token punctuation\">(</span>most recent call last<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">&lt;</span>ipython<span class=\"token operator\">-</span><span class=\"token builtin\">input</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token operator\">-</span>f03e96cb5e14<span class=\"token operator\">></span> <span class=\"token keyword\">in</span> <span class=\"token operator\">&lt;</span>module<span class=\"token operator\">></span>\n<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token number\">1</span> printer<span class=\"token punctuation\">(</span><span class=\"token string\">\"one\"</span><span class=\"token punctuation\">)</span>\n\nTypeError<span class=\"token punctuation\">:</span> printer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> takes <span class=\"token number\">0</span> positional arguments but <span class=\"token number\">1</span> was given</code></pre></div>\n<h2>Avoid Anti-Patterns</h2>\n<p>Just as above, if your items are clearly separate things, make them separate things and do not use <code class=\"language-text\">**kwargs</code>.  <code class=\"language-text\">**kwargs</code> are great when you have collections of things that all get treated exactly the sam, if they get treated differently, or you are expecting certain keys to always exist it will be very confusing to your users what they need to pass in.</p>\n<h2><img src=\"https://waylonwalker.com/args-kwargs/4.png\" alt=\"sending **kwargs\"></h2>\n<p>Sending <code class=\"language-text\">**kwargs</code> is quite useful.  Especially when combining various libraries together.  Often times you can coerse objects into a dictionary, often with something like <code class=\"language-text\">.to_dict()</code>, then pass that whole dictionary to another function.  This makes gluing different libraries together a breeze at times.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> things_to_print <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>breakfast<span class=\"token punctuation\">:</span><span class=\"token string\">'eggs'</span><span class=\"token punctuation\">,</span> lunch<span class=\"token punctuation\">:</span><span class=\"token string\">'spam'</span><span class=\"token punctuation\">,</span> dinner<span class=\"token punctuation\">:</span><span class=\"token string\">'ham'</span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> printer<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>things_to_print<span class=\"token punctuation\">)</span>\nbreakfast eggs\nlunch spam\ndinner ham</code></pre></div>\n<hr>\n<p>I setup a repl.it with these examples so that you can quickly jump in, run it, break it, fix it, add breakpoints and really get a feel for them yourself. Check it out üëâ <a href=\"https://repl.it/@WaylonWalker/args#main.py\">https://repl.it/@WaylonWalker/args#main.py</a></p>\n<hr>\n<p>I hope this helps you understand <code class=\"language-text\">*args</code> and <code class=\"language-text\">**kwargs</code> just a bit more.  They can be quite handy to greatly simplify repetative code, expecially if we already have the data setup in the right data structure.</p>","fields":{"slug":"/python-args-kwargs/"},"frontmatter":{"tags":[],"title":"understanding python *args and **kwargs","description":"Python `*args` and `**kwargs` are super useful tools, that when used properly can make you code much simpler and easier to maintain.  Large manual conversions from a dataset to function arguments can be packed and unpacked into lists or dictionaries. Beware though, this power **can** lead to some really unreadable/unusable code if done wrong.","templateKey":"blog-post","status":"published","date":"2020-06-10T05:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAByElEQVQY0yXRzW/SYADH8Z6NJmZjFBhdC+1DaWn7PH36St8I0I7yNrLSwTqSjRkS4rKbMTNy8aAxMWK86UEPXv0T/OusM/mdfsn39CGqnJqvzKoUhyocYoDeleIYTsZ4dq7Nh/jM7Z7Nk9vl5bbX8bI0sAwHYkfFNlRNopKXj1mpDsssOuYwtPqforcPwf0+2n0I3+SPIHhNwdM03/d8QXYaYpuXLAk+xscsOqhKstmfpNd+nESzy2dM8wkFQMMmOfWwLgMpD/x0GqyX7mblrbMgnTmOYxGlGqIlHI00v++1zVEXjzri6ZWRma1eq+nGaNqH4xv3xtFiywqWF8v1KhmF+vnUDXs2UWCRDZTUVo84pUShE8ZkQftLtPsWvduHu1/jj3fO5vd0v45edOM0HiTa6Ya2V7xgSNAintPSw/X2fr4mgSIi1XBQCyOShtu719Fw8bQMqhyWxYCXPCg7TW0Qv/r84+fL24UJRIsoMhCoanZlJTMjuzDHQ63tmZ1BEk4WPPJJRimxsFCTGN5QoFsTwq/vx3++27phUwATxRpkBaTgXAsWaHhAwSMGluvokGoVGTkn+K9A1pQKqzINzIs6zetF5p/OX/1GbQHqpvszAAAAAElFTkSuQmCC","width":500,"height":210,"src":"/static/8c73a5e2f384efdcd17762c52faff94f/46604/python-args-kwargs-xmas2020.png","srcSet":"/static/8c73a5e2f384efdcd17762c52faff94f/46604/python-args-kwargs-xmas2020.png 1x,\n/static/8c73a5e2f384efdcd17762c52faff94f/d8815/python-args-kwargs-xmas2020.png 1.5x,\n/static/8c73a5e2f384efdcd17762c52faff94f/31987/python-args-kwargs-xmas2020.png 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAACA0lEQVQozx2RO5PSUACFUzp2urIugZW8ICHJTe4NITc3kITHMrzCI2EDCAKyK+vsMttoYaXjOiMWVs5oYaOdvWNp5d/xV8g6c4rTfHPOzEc9ykI6h44FlMkhWoAE1IFUSvOAz1tiFqu612yMN89frFfXxMLdrm8ZjmYQCImOMJUSYFJAKR6mBXjIaa7caGrBCs9Pi+NLe101u5XGKI7Pw+is5pHLpz4uOgASiOxbmObhfvCI02keJTkomn7oTL61dlNz+iv6MrOfJFgg592sRIDuYqusaCVBIjnFloFFHfHwXhpwqhPNzq16EIxXWcu7SwtJHualcoK//SVprih7y9h7NnOWY7KauuPQqVVsilEKzU7RP3FN0mqRIRL9Hgyh7O9hNmuacsXTWgMcA9137PIkjs4Wo9PAmkalqOdQQkbqlVQB6DSjG1KFFaxtefOz/+lz9fWP4OP3zu6le/U7+jppLGvteNCfnwQLthAyOaxBTL1bXLwN13doNcHoqRxgFC2ZAW1n9Gr7BsmVjGCivN8uDDVYgchTjRqYf1jfvN+uiChjyqo2xrPmsG8sH1uLKe4HJiLlZrycX1zfZ5RDDjxgwQGriooDNYfXOje7zd8/1aulw4pFKqco3RY0sCFDlM7qD1ktb7i8ah+k83sF++wVJP8XTiryEu7UrckA03xhr+kfPVl/o5bPSIUAAAAASUVORK5CYII=","width":200,"height":85,"src":"/static/8c73a5e2f384efdcd17762c52faff94f/71e30/python-args-kwargs-xmas2020.png","srcSet":"/static/8c73a5e2f384efdcd17762c52faff94f/71e30/python-args-kwargs-xmas2020.png 1x,\n/static/8c73a5e2f384efdcd17762c52faff94f/24123/python-args-kwargs-xmas2020.png 1.5x,\n/static/8c73a5e2f384efdcd17762c52faff94f/492a0/python-args-kwargs-xmas2020.png 2x"}}}}},"next":{"id":"bcc35310-7de8-5105-a7af-5ca694c091af","html":"<p>Is it possible to deep watch a single python function for changes?</p>\n<h2>Shallow Watch</h2>\n<p>keeping track of a python functions hash is quite simple.  There is a<code class=\"language-text\">__hash__</code> method attached to every python function.  Calling it will return a hash of the function. If the function changes the hash will change.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760526380347</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760526380347</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello world\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760525617988</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760526380491</span></code></pre></div>\n<p>Using hashlib provides a consistent hash.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> inspect\n<span class=\"token keyword\">import</span> hashlib\n<span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>sha256 HASH <span class=\"token builtin\">object</span> @ <span class=\"token number\">0x7f7b7b70fde0</span><span class=\"token operator\">></span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">19</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">19</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1f2ff4c69eb69b545469686edd6f849136e104cd535785891586d90620328757'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'93638f2c944f34a9069af9242657b7de556fcc63742f4c27c4c8deedeb976a5f'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">22</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">23</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">24</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">25</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">27</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">27</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1f2ff4c69eb69b545469686edd6f849136e104cd535785891586d90620328757'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">28</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello world\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">29</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'121fa3a3f295d49d4609505bc5e96d8b6a8ed3b496e4f3dc6c0ead73bef4e3c7'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">33</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">34</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">35</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">35</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1f2ff4c69eb69b545469686edd6f849136e104cd535785891586d90620328757'</span></code></pre></div>\n<p>Now we have a consistent way to hash function code.</p>\n<h2>Deep hashing</h2>\n<h3>Find dependencies</h3>\n<p>setup a function in a module with a dependency</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">       ‚îÇ File<span class=\"token punctuation\">:</span> one<span class=\"token punctuation\">.</span>py\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n   <span class=\"token number\">1</span>   ‚îÇ <span class=\"token keyword\">def</span> <span class=\"token function\">one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token number\">2</span>   ‚îÇ     <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n   <span class=\"token number\">3</span>   ‚îÇ\n   <span class=\"token number\">4</span>   ‚îÇ <span class=\"token keyword\">def</span> <span class=\"token function\">two</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token number\">5</span>   ‚îÇ     <span class=\"token keyword\">return</span> one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">import</span> one\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> one<span class=\"token punctuation\">.</span>one<span class=\"token punctuation\">.</span>__code__<span class=\"token punctuation\">.</span>co_names\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> one<span class=\"token punctuation\">.</span>two<span class=\"token punctuation\">.</span>__code__<span class=\"token punctuation\">.</span>co_names\n<span class=\"token punctuation\">(</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Create Generic module importer by filepath</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> importlib\n<span class=\"token keyword\">import</span> importlib<span class=\"token punctuation\">.</span>util\n<span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">_import</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">:</span> Path<span class=\"token punctuation\">,</span> directory<span class=\"token punctuation\">:</span> Path<span class=\"token punctuation\">,</span> verbose<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"dynamically imports module given a path\"\"\"</span>\n    cwd <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getcwd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    os<span class=\"token punctuation\">.</span>chdir<span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span>name\n    <span class=\"token comment\"># path = str(path).replace(str(directory) + \"/\", \"\")</span>\n    path <span class=\"token operator\">=</span> _make_path_relative<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> directory<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        spec <span class=\"token operator\">=</span> importlib<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>spec_from_file_location<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span>\n        module <span class=\"token operator\">=</span> importlib<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>module_from_spec<span class=\"token punctuation\">(</span>spec<span class=\"token punctuation\">)</span>\n        spec<span class=\"token punctuation\">.</span>loader<span class=\"token punctuation\">.</span>exec_module<span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> <span class=\"token punctuation\">(</span>ModuleNotFoundError<span class=\"token punctuation\">,</span> ValueError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        module <span class=\"token operator\">=</span> _use_importmodule<span class=\"token punctuation\">(</span>\n            <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>sep<span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">\".py\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> verbose<span class=\"token operator\">=</span>verbose\n        <span class=\"token punctuation\">)</span>\n    os<span class=\"token punctuation\">.</span>chdir<span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> module\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">_use_importmodule</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">:</span> Path<span class=\"token punctuation\">,</span> verbose<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    relative imports do not work well with importlib.util.spec_from_file_location,\n    and require a sys.path.append to be imported correctly.  For this reason\n    importlib.import_module is the second option.\n    \"\"\"</span>\n\n    <span class=\"token comment\"># Not sure if this is needed, but it was never hit in a test</span>\n    <span class=\"token comment\"># if path[0] == \".\":</span>\n    <span class=\"token comment\">#     path = path[1:]</span>\n\n    sys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>getcwd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    mod <span class=\"token operator\">=</span> importlib<span class=\"token punctuation\">.</span>import_module<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># clean up path, do not permananatly change users path</span>\n    <span class=\"token keyword\">return</span> mod</code></pre></div>\n<h3>get code of dependency</h3>\n<p>the inspect module can tell us the filename of our current module.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> inspect\nmodule_path <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">.</span>getfile<span class=\"token punctuation\">(</span>one<span class=\"token punctuation\">.</span>one<span class=\"token punctuation\">)</span>\nmodule <span class=\"token operator\">=</span> _import<span class=\"token punctuation\">(</span>module_path<span class=\"token punctuation\">)</span></code></pre></div>\n<p>now we can hash the dependency</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">nested_function <span class=\"token operator\">=</span> <span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span>f'module<span class=\"token punctuation\">.</span><span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">.</span>two<span class=\"token punctuation\">.</span>__code__<span class=\"token punctuation\">.</span>co_names<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\"</code></pre></div>","fields":{"slug":"/python-deepwatch/"},"frontmatter":{"tags":[],"title":"python-deepwatch","description":"Is it possible to deep watch a single python function for changes? Shallow Watch keeping track of a python functions has","templateKey":"blog-post","status":"published","date":"2020-04-27T05:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABqElEQVQY032RTU8TURSG5w9QoZYwM739ujN3vueeezudO2UKKaAhGiOJS6MQYkIKYgu0tRSQFHSDSU1MNMSNbFy4cOPCH+idujd5Fk9O8ibnvEdBJpdoBkcGQyRzXQoGzQApFRI5fovSNUpXKbQoX2GQUp4CbwIXii6TJi+SukTF7J/IiYqhYokg3ChbcUjXgEnaACsha4WwHLImZbOwjqGA3AXkIiua1525JZJHXqES6JhpJVZAPjaEQSSR4yVekATQDEBQnigahqIr9oeX3f7Fz1+/O93Rh4+fHz97UU83v3y7G5xfH48m0+nt8O1kMrmZfvr6/e5Hf3juBg2Q4XsVuuzEZ68OuuOrw5Oznb1epzdKH2wl7Sf98fX2Xq87ePf6zfjo+KI/uDw4HB6djHd2O5TP1q467M/N+6vn+7mSP6/ZcuecauVL3v2yP6eSnGYtIE8th4YZmyQmdoPYkeXUaXZzolCA29OXT1tb+XKAZm0Vs/KZRHrWiJl5zRURX08bD9fFo7bYXI02DKehLNaoVvU1HMp6/8NSLfsctmPTFVU7ko+Uk7/4cWrJ8tZ/KQAAAABJRU5ErkJggg==","width":500,"height":210,"src":"/static/3d31abd6ddd9eb39a94d89c56d81cedc/46604/python-deepwatch-xmas2020.png","srcSet":"/static/3d31abd6ddd9eb39a94d89c56d81cedc/46604/python-deepwatch-xmas2020.png 1x,\n/static/3d31abd6ddd9eb39a94d89c56d81cedc/d8815/python-deepwatch-xmas2020.png 1.5x,\n/static/3d31abd6ddd9eb39a94d89c56d81cedc/31987/python-deepwatch-xmas2020.png 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0ElEQVQoz32Q72oTQRTF96tg44fYZHeTTJOd2c3+yc7c2ezm7y5psb5CQSn4JQZqCYm1aaXNBkxVStK0atqgVYrgk/hmzuYBhMPlMNxzh/OTkO4hHVSDFwhHBhSIlyOQx4AIVXTYwtx0WkB3XNYBN+LQdr2oSlvMawI0pRzhYlshXMUgTA6DSkB4FTMZM0VjSK9aTujSDqURZW0XQmAtypsUGpJKuCJiuickjLz24lHWIFuiltMRQobPIPmcQYeyiPLQZc1KEsYgMk/Ucko2nm5V0gXnUbr0OEsyRZpGTiZP04qTztnFkq9hIc8wA2JwywkqrL4OG9UX3f7efu/Hw5/js2mvPzoYnIqLr3qDy8Vyv9t/fTiK48uDN6Ojd/GH6ezrt+/n42kS3tRYEdnx8PTz4nZ2cze5mF8v74cnE2T6w9Fkdf/7/eTT7GY1n99dXa+Wtz/Pxx+vFstxfFFrbEsZjf0aHH152VXt+iZyNrL6hqyLFpmkgp1SDFFHIMyXPExqRA9008dljstg0UAKPPb34ezt3mFKNhXBWWAnCQVZY0JKAp8LcmJalXbAdxres8h/Hvq727VdKU9o6INBWHa9/X9hs+a6bc4il7bKdv0fcQV5h7qzDuIAAAAASUVORK5CYII=","width":200,"height":85,"src":"/static/3d31abd6ddd9eb39a94d89c56d81cedc/71e30/python-deepwatch-xmas2020.png","srcSet":"/static/3d31abd6ddd9eb39a94d89c56d81cedc/71e30/python-deepwatch-xmas2020.png 1x,\n/static/3d31abd6ddd9eb39a94d89c56d81cedc/24123/python-deepwatch-xmas2020.png 1.5x,\n/static/3d31abd6ddd9eb39a94d89c56d81cedc/492a0/python-deepwatch-xmas2020.png 2x"}}}}},"similarPosts":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}},"staticQueryHashes":["2992646504"]}
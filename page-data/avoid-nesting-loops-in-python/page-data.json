{"componentChunkName":"component---src-templates-blog-post-js","path":"/avoid-nesting-loops-in-python/","result":{"data":{"markdownRemark":{"id":"362278e4-41d7-5211-8b3d-cea698a1887b","html":"<p>Nesting loops inside of each other in python makes for much harder code to understand, it takes more brain power to understand, and is thus more error prone than if its avoidable.  One issue with this complexity is that toy examples may make sense, but most real example will grow and become more deeply nested over time.  Avoiding this complexity from the start can help simplify the project in the future.</p>\n<h2>setup</h2>\n<p>Lets take a pretty simple example where we are using a ficticious library to get some sales data for our transportation company.  The api allows us to fetch teh sales data for one class of vehicle and one region at a time.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n\n<span class=\"token keyword\">from</span> datastore <span class=\"token keyword\">import</span> get_sales  <span class=\"token comment\"># ficticious library</span>\n\ncars <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span>\nregions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'US'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>‚ùå Nesting Loops</h2>\n<p>We have setup to fetch our data with two lists that represent the vehicles and regions that we want to analyze.  We know that we need to make a call to <code class=\"language-text\">get_sales</code> for every vehicle and region so nesting loops is a very common first solution to jump to.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> car <span class=\"token keyword\">in</span> cars<span class=\"token punctuation\">:</span>\n   <span class=\"token keyword\">for</span> region <span class=\"token keyword\">in</span> regions<span class=\"token punctuation\">:</span>\n      new_sales <span class=\"token operator\">=</span> get_sales<span class=\"token punctuation\">(</span>car<span class=\"token punctuation\">,</span> region<span class=\"token punctuation\">)</span>\n      sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>sales<span class=\"token punctuation\">,</span> new_sales<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>itertools.product</h2>\n<p>Python provides us with the beautiful itertools module that allows us to prepare our inputs for this in a much more susynct manner.  The product function of itertools will give us every combination of any number of iterables</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> itertools\n<span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> regions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>note that itertools returns a generator for most if not all functions, list() will turn that into a list that we can see.  This works great for small datasets, but might not be advisable on larger ones.</p>\n</blockquote>\n<p><strong>output</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'US'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'US'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'US'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>itertools.procuct for loop</h2>\n<p>Now that we have every comination of our two sets of inputs in a single list, we can iterate over that list one time.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> car<span class=\"token punctuation\">,</span> region <span class=\"token keyword\">in</span> itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> regions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   new_sales <span class=\"token operator\">=</span> get_sales<span class=\"token punctuation\">(</span>car<span class=\"token punctuation\">,</span> region<span class=\"token punctuation\">)</span>\n   sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>sales<span class=\"token punctuation\">,</span> new_sales<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>itertools.product list comprehension</h2>\n<p>The above follows a python anti-pattern, initialize then edit.  In some cases it might be a bit more readable to do it that way, you can be the judge, but in our simple case we can simply achieve the same results using a list comprehension.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>get_sales<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> region<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> cars<span class=\"token punctuation\">,</span> region <span class=\"token keyword\">in</span> itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> regions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>dictionaries</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales_args <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token string\">'cars'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">'regions'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'US'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\npd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>get_sales<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_arg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> sales_arg <span class=\"token keyword\">in</span> itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_args<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales_args <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token string\">'cars'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">'regions'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'US'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">'month'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'MAR'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'APR'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MAY'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\npd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>get_sales<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_arg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> sales_arg <span class=\"token keyword\">in</span> product<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_args<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<hr>\n<h2>Chaining</h2>\n<p><em>containers of containers</em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">vehicles <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token string\">'cars'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'trucks'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'light'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'heavy'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sport'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'offroad'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'van'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'box'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mini'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'full'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">for vehicle in vehicles:\n\tfor sub_class in vehicles[vehicle]:\n      new_sales = get_sales(sub_class)\n      new_sales[&#39;sub_class&#39;] = sub_class\n      new_sales[&#39;vehicle&#39;] = vehicle\n      sales = pd.concat([sales, new_sales])</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> list(itertools.chain(*[list(itertools.product([k], v)) for k, v in vehicles.items()]))</code></pre></div>\n<p>output</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[(&#39;cars&#39;, &#39;sedan&#39;),\n (&#39;cars&#39;, &#39;coupe&#39;),\n (&#39;cars&#39;, &#39;hatchback&#39;),\n (&#39;trucks&#39;, &#39;light&#39;),\n (&#39;trucks&#39;, &#39;heavy&#39;),\n (&#39;trucks&#39;, &#39;sport&#39;),\n (&#39;trucks&#39;, &#39;offroad&#39;),\n (&#39;van&#39;, &#39;box&#39;),\n (&#39;van&#39;, &#39;mini&#39;),\n (&#39;van&#39;, &#39;full&#39;)]</code></pre></div>","fields":{"slug":"/avoid-nesting-loops-in-python/"},"frontmatter":{"date":"2020-10-11T05:00:00.000Z","title":"Avoid Nesting Loops in Python","description":"Nesting loops inside of each other in python makes for much harder code to understand, it takes more brain power to unde","status":"draft","cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/avoid-nesting-loops-in-python-xmas2020.png","xsm_img":{"fixed":{"src":"/static/83aa845b95a47f9f95ad621e6a3f2555/ef958/avoid-nesting-loops-in-python-xmas2020.png","srcWebp":"/static/83aa845b95a47f9f95ad621e6a3f2555/f6b6d/avoid-nesting-loops-in-python-xmas2020.webp"}},"sm_img":{"fixed":{"src":"/static/83aa845b95a47f9f95ad621e6a3f2555/630fb/avoid-nesting-loops-in-python-xmas2020.png","srcWebp":"/static/83aa845b95a47f9f95ad621e6a3f2555/403a4/avoid-nesting-loops-in-python-xmas2020.webp"}},"med_img":{"fixed":{"src":"/static/83aa845b95a47f9f95ad621e6a3f2555/46604/avoid-nesting-loops-in-python-xmas2020.png","srcWebp":"/static/83aa845b95a47f9f95ad621e6a3f2555/e9589/avoid-nesting-loops-in-python-xmas2020.webp"}},"full":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABgklEQVQY032RyUoDQRCGc/cWE81kmSTTMbP0Vp1ZMqOdONFEXHC/aUBF9CAGPLggelAU9Al8E9/PmoAXD8JPU930X/X137lqS6EMoqpEVVowXbGWBsqS9QXfoUtCpEL0JGiuNMhEqEWpYqmiXBmdmRlKlsS6RGC+KUrTbb0duTQ12wHly1T0GddCag5LXCYMugKm5jKB6oKq2X6hzrCL6YTFOps1adlSxI7nTO56mstl1Rm4XtdjXQ4JhzgzVwgUCBhOdPv4enXzuHU4vn9+Pzq7upzcbewfjy8ml9d3u3snB4en9w8vT8/vZ+fXiM1xsurm8hbwmhdZrB2kEA8JS2zQLBzQIHU7fRkPIRl1wlEQjnRvc7C6o/vriJ1Nxjc3HPj+fPs4mcxU3KJJ5xocmQsmimbwNZqveVXSobzn0UXnFxsDy7CFlF8P461kO2+y8jS5P8pSxPDsQMk08YdpuNYLVrW/QuwgV2wKo0GNJscb/2i+KTFXyw5bbtSwffxIPPkBvu5dZCkdmSUAAAAASUVORK5CYII=","width":1000,"height":420,"src":"/static/83aa845b95a47f9f95ad621e6a3f2555/a8734/avoid-nesting-loops-in-python-xmas2020.png","srcSet":"/static/83aa845b95a47f9f95ad621e6a3f2555/a8734/avoid-nesting-loops-in-python-xmas2020.png 1x"},"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABgklEQVQY032RyUoDQRCGc/cWE81kmSTTMbP0Vp1ZMqOdONFEXHC/aUBF9CAGPLggelAU9Al8E9/PmoAXD8JPU930X/X137lqS6EMoqpEVVowXbGWBsqS9QXfoUtCpEL0JGiuNMhEqEWpYqmiXBmdmRlKlsS6RGC+KUrTbb0duTQ12wHly1T0GddCag5LXCYMugKm5jKB6oKq2X6hzrCL6YTFOps1adlSxI7nTO56mstl1Rm4XtdjXQ4JhzgzVwgUCBhOdPv4enXzuHU4vn9+Pzq7upzcbewfjy8ml9d3u3snB4en9w8vT8/vZ+fXiM1xsurm8hbwmhdZrB2kEA8JS2zQLBzQIHU7fRkPIRl1wlEQjnRvc7C6o/vriJ1Nxjc3HPj+fPs4mcxU3KJJ5xocmQsmimbwNZqveVXSobzn0UXnFxsDy7CFlF8P461kO2+y8jS5P8pSxPDsQMk08YdpuNYLVrW/QuwgV2wKo0GNJscb/2i+KTFXyw5bbtSwffxIPPkBvu5dZCkdmSUAAAAASUVORK5CYII=","aspectRatio":2.380952380952381,"src":"/static/83aa845b95a47f9f95ad621e6a3f2555/a8734/avoid-nesting-loops-in-python-xmas2020.png","srcSet":"/static/83aa845b95a47f9f95ad621e6a3f2555/2d6f8/avoid-nesting-loops-in-python-xmas2020.png 250w,\n/static/83aa845b95a47f9f95ad621e6a3f2555/03ac3/avoid-nesting-loops-in-python-xmas2020.png 500w,\n/static/83aa845b95a47f9f95ad621e6a3f2555/a8734/avoid-nesting-loops-in-python-xmas2020.png 1000w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"362278e4-41d7-5211-8b3d-cea698a1887b","prev":{"id":"ec3083c5-7ebe-5adc-bcc3-ea419b4ca11f","html":"<h1>Autoreload in Ipython</h1>\n<p>I have used <code class=\"language-text\">%autoreload</code> for several years now with great success and üî• rapid reloads.  It allows me to move super fast when developing libraries and modules.  They have made some great updates this year that allows class modules to be automatically be updated.</p>\n<h2>What I like about autoreload</h2>\n<p>üî• Blazing Fast</p>\n<p>üí• Keeps me in the comfort of my text editor</p>\n<p>üëè Allows me to use Jupyter when I need</p>\n<p>üëü Extremely Reliable</p>\n<p>One of the biggest benefits that I find is that it shortens the distance between my module/library code and test code inside of a terminal/notebook.  Now I primarily use jupyter notebooks for the presentation aspect.  I develop code from the comfort of my editor with all of the tools I have setup, and run the functions in a notebook to get the output.  From there I might do some aggregations or plots, but the ü•© meat of development is done outside of jupyter.</p>\n<blockquote>\n<p>Now I primarily use jupyter notebooks for the presentation aspect.</p>\n</blockquote>\n<h2>Enabling Autoreload</h2>\n<p>üìê <em>config</em></p>\n<p>This is a short script that I use to setup ipython so that it automatically reloads modules.  This allows me to use a separate terminal and editor, and keep data in memory while developing functions.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ipython profile create</code></pre></div>\n<p>Then edit the created file <code class=\"language-text\">~/.ipython/profile_default/ipython_config.py</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">c<span class=\"token punctuation\">.</span>InteractiveShellApp<span class=\"token punctuation\">.</span>extensions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'autoreload'</span><span class=\"token punctuation\">]</span>\nc<span class=\"token punctuation\">.</span>InteractiveShellApp<span class=\"token punctuation\">.</span>exec_lines <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'%autoreload 2'</span><span class=\"token punctuation\">]</span>\nc<span class=\"token punctuation\">.</span>InteractiveShellApp<span class=\"token punctuation\">.</span>exec_lines<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">'print(\"Warning: disable autoreload in ipython_config.py to improve performance.\")'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>According to the docs</h2>\n<p><a href=\"https://ipython.org/ipython-doc/3/config/extensions/autoreload.html#caveats\" title=\"IPython caveats\">autoreload caveates</a></p>\n<blockquote>\n<p>Some of the known remaining caveats are:</p>\n<p>Replacing code objects does not always succeed: changing a @property in a class to an ordinary method or a method to a member variable can cause problems (but in old objects only).\nFunctions that are removed (eg. via monkey-patching) from a module before it is reloaded are not upgraded.\nC extension modules cannot be reloaded, and so cannot be autoreloaded.</p>\n</blockquote>\n<h2>So what can gets updated??</h2>\n<p>ü§≤ <em>Nearly everything...</em></p>\n<ul>\n<li>new/updated functions</li>\n<li>new/updated functions</li>\n<li>new/updated class methods</li>\n<li>new/updated class attributes</li>\n</ul>\n<h2>What does not get updated</h2>\n<p>üîÑ <em>needs restart</em></p>\n<p><strong>config</strong> files that are side loaded with modules typically do not get updated in my experience, and I tend to restart the session.</p>\n<p><strong>init</strong> class methods do not get reran, but the session does not need to be reloaded.  The class instance will just need to be re-instanciated.</p>\n<h2>Testing out the capabilities</h2>\n<p>üí® <em>Watch</em> it go</p>\n<p>Here is a gif of me taking autoreload out for a test drive.  When creating the session test_autoreload.py does not even exist. From there new functions, classes, attributes, and methods are added in the file and all live reload into ipython.</p>\n<p><img src=\"../../test_autoreload4.gif\">\n<em>for more gifs like these follow me on twitter</em> <a href=\"https://twitter.com/_WaylonWalker\"><em>@waylonwalker</em></a></p>\n<h2>What About Jupyter Notebooks????</h2>\n<p>üí• <em>Exactly the Same</em></p>\n<p>Since jupyter uses ipython in be background Jupyter will use the same <code class=\"language-text\">ipython_config.py</code> file to have autoreload enabled by default.</p>\n<p><img src=\"../../test_autoreload_jupyter.gif\">\n<em>for more gifs like these follow me on twitter</em> <a href=\"https://twitter.com/_WaylonWalker\"><em>@waylonwalker</em></a></p>\n<h2>Go use it now</h2>\n<p>Take the splash into rapid development of python functions with minimal distance between your modules/library and your ipython/jupyter session.</p>","fields":{"slug":"/autoreload-ipython/"},"frontmatter":{"tags":["python"],"title":"Autoreload in Ipython","description":"Autoreload in python","templateKey":"blog-post","status":"published","date":"2019-09-08T05:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVQY013PzW7TQBDA8TwBpSEtsVPX7q7tON6PmXXirNexA2lJKqBBBNQWmkjlSwhUIaSqUjkhIYTgwpWH4M77YecG0lzm8NP8p+H4yg3QDtWur5wQq7VJmE34LRq3KZBoGMsxE6UQI8RCJmUfDCS5Uhkq3djxVTUWVTsUbb/GQag3vd4NL2p6ccdHr6d9ZoQoAQqhCgQjVQ4qAzVs2JWsMVa+RYTsjX/Pf34s3n2ZXL4xrz7vX12NL75Nr18WLwKuAUoOuQDDUUtcY7u6WWO8TcEP9bleLdOzZfr8UD06NWcLfHpRvF1kx5HIZXW8wmgEZmtMcTtIWlTZBC2C20RsuFVzXGfvsTAtmZmwdEIizfhI/IebBIUTDwnfosoi0CbQoYnliS1HtvfQ7Q7uzp4sV+9Pjl/rbMZl/g/2Ivzz4+v38w8bu9ymUMe7jGTz/OixH7JpqtpuHMjR/QfPjDlkdXmNQZkaS4Bf16uHZr7pMGv9/M0Ony2OPl3eo12cDhM3xJYrLA8kL7Pk4E5/Vg4Oiv4+7Q7+ApJFX6of+/B6AAAAAElFTkSuQmCC","width":500,"height":210,"src":"/static/de227ffcb7da2e5c1170a8434163bec9/46604/autoreload-ipython-xmas2020.png","srcSet":"/static/de227ffcb7da2e5c1170a8434163bec9/46604/autoreload-ipython-xmas2020.png 1x,\n/static/de227ffcb7da2e5c1170a8434163bec9/d8815/autoreload-ipython-xmas2020.png 1.5x,\n/static/de227ffcb7da2e5c1170a8434163bec9/31987/autoreload-ipython-xmas2020.png 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxUlEQVQoz03PW2sTQRgG4Nx7aEvTZneTbPYwe8juzDeHzW72lE2TKFbrRcRSJDTVUFBLsaUKovVSEMUrvVQQ/Cn+MycJiPAyDDM8fN9b0x2hO0xzeRtx3WU6EnUr3DGxaoV1hJsWtboJJpUPJcYFZyURZQQ5FRljWa2JeBMxFXHNZvKi2NT3sm0z3Oj4tzre7Y4vX9p+bIVpSEpKS8JKRnPgGbC0piGu2kxGsZlm800z+H3w+cf+x5f56fXw8s3w1afJu6vq7Ou9D/Ni7uKU0gGmOaEZXuKV/OebNn8cHb6tzmfJ7Gly/KQ/O80Xi+Tk/ejyQTLtkhzk8BUma6w4ouGItW9YsGWEN+XCRvdGy9W6wkuHBqQOFLbfJ0TK//CunKY4qOU1EFcsKqNaTLOYaoTy3NZJEI8fHS0Wzy5Go6nojTEUsMKwwvTnxdX3+fONDlFXWLFAsbkaTTUvhhByzjebwWT/cDZ7UQzud0kWUpk0oEktFvTPr+vXR+dbWriurRh4x6u+fDt7eCCxqHrLRnUdG06PwzAVk0F0t4jGe/GdWgtB2WMuorvmeuwyDZPuVaTtAoEYApBfqi3D1rU5HRDIvaD/FwbTaojCZgLYAAAAAElFTkSuQmCC","width":200,"height":85,"src":"/static/de227ffcb7da2e5c1170a8434163bec9/71e30/autoreload-ipython-xmas2020.png","srcSet":"/static/de227ffcb7da2e5c1170a8434163bec9/71e30/autoreload-ipython-xmas2020.png 1x,\n/static/de227ffcb7da2e5c1170a8434163bec9/24123/autoreload-ipython-xmas2020.png 1.5x,\n/static/de227ffcb7da2e5c1170a8434163bec9/492a0/autoreload-ipython-xmas2020.png 2x"}}}}},"next":{"id":"2323e978-45ff-5c4a-be68-3d9c65343212","html":"<h1>background tasks in python</h1>\n<p>I have tried most of the different methods in the past and found that copying and pasting the <a href=\"https://docs.python.org/3/library/concurrent.futures.html#threadpoolexecutor-example\">threadpoolexecutor example</a> or the <a href=\"https://docs.python.org/3/library/concurrent.futures.html#processpoolexecutor-example\">processpoolexecutor example</a> from the standard library documentation to be the most reliable.  Since this is often something that I stuff in the back of a utility module of a library it is not something that I write often enough to be familiar with, which makes it both hard to write and hard to read and debug.  If you are looking for a good overview of the difference concurrency <a href=\"https://twitter.com/raymondh\">Raymond Hettinger</a> has a great talk about the difference between the various different methods, when to use them and why.</p>\n<p>Recently a new python library was released to make running tasks in the background very simple. The <a href=\"https://github.com/kennethreitz/background\">background</a> project by Kenneth Reitz is a high level implementation of python 3's ThreadPoolExecutor.  I have been playing around with this project over the last week and I will say that this is definitely the simplest way to run background tasks in python by far.  It really simplifes the syntax and lets me focus on my job rather than implementing custom concurrent code that is more difficult to debug.</p>\n<h2>Background</h2>\n<p>I have pulled the latest version of the project in Sept 2017.  I found that it had some updates that were important to pass *args and **kwargs compared to the pypi version.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> background <span class=\"token keyword\">as</span> bg\n\n<span class=\"token operator\">%</span>load_ext watermark\n<span class=\"token operator\">%</span>watermark <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>v <span class=\"token operator\">-</span>p background</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2017-09-16\n\nCPython 3.6.2\nIPython 6.1.0\n\nbackground n\u0007</code></pre></div>\n<h2>Define Worker Functions</h2>\n<p>Each of these worker functions takes 1s to run, simulating a moderately long calculation that we need to do many times over.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">work</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n\n<span class=\"token decorator annotation punctuation\">@bg<span class=\"token punctuation\">.</span>task</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">bg_work</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span></code></pre></div>\n<h2>Run the Worker Functions</h2>\n<h2>Blocking function</h2>\n<p>This function is blocking each time the function runs, thus taking 1 second to run for each calculation.  The example below took exactly <strong>100 s</strong> to run 100 calculations.  Depending on your use case this may not be fast enough.  If the calculations do not rely on the global state</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span><span class=\"token operator\">%</span>time\n<span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    work<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Wall time: 1min 40s</code></pre></div>\n<h3>Reaction</h3>\n<p>I  know what half of you are saying to yourselfs..</p>\n<blockquote>\n<p>   !!What!! that took 100 s, by now my users have already sent a dozen messages and filed an issue that my feature is down</p>\n</blockquote>\n<p>and the other half</p>\n<blockquote>\n<p>Seriously that wasnt even enough time to grab a coffee.  Any real time consuming analysis takes at least 3 dats 14 hours 159 seconds before I start to care about concurrency</p>\n</blockquote>\n<p>To you I say... I am impatient and I got other things to do rather than wait on this maching to finish its work.  Let's get into this concurrency stuff.</p>\n<h2>Background Function</h2>\n<p>This function spins off worker processes and runs much faster.  By default background sets the number of processes to the number of cpu cores available, Therefore this function should run in n/4 + (inefficiency).  Here we see that the result is just over <strong>13 s</strong>.</p>\n<p>Note:<em>Since there is a bit of inefficiency added by needing to handle all of the threads it is not exactly divided by the number of workers.</em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span><span class=\"token operator\">%</span>time\nf_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>bg_work<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> <span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> f <span class=\"token keyword\">in</span> f_list<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Wall time: 13.1 s</code></pre></div>\n<h3>Reaction</h3>\n<p>I know what your saying this time.</p>\n<blockquote>\n<p>really a 7.6x improvement...  Is that really even woth the extra work.</p>\n</blockquote>\n<p>Fine then lets crank it up to 11!</p>\n<h3>Lots of Background</h3>\n<p>lets set the number of background processes to a value just higher to than the number of workers we need to run in order to start them all simultaneously. With this simple example that is not very CPU intensive we see the result is just over the amount of time that it takes to run 1 worker.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">bg<span class=\"token punctuation\">.</span>n <span class=\"token operator\">=</span> <span class=\"token number\">110</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span><span class=\"token operator\">%</span>time\nf_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>bg_work<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> <span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> f <span class=\"token keyword\">in</span> f_list<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Wall time: 1.09 s</code></pre></div>\n<h3>Reaction</h3>\n<blockquote>\n<p>91x improvement by putting my calculations into a function, adding a decorator, and some checks, im in.</p>\n</blockquote>\n<h2>On Tap</h2>\n<p>This week while taking it up to 11 I was enjoying a super thick and rich cup of El Salvador Finca Rosa from Onyx Coffee Labs.  Check out their love for letting the bean speak for it self and producing a great cup.</p>\n<p><a href=\"https://onyxcoffeelab.com\"><img src=\"https://cdn.shopify.com/s/files/1/1707/3261/files/coffee_science.png?5305428688827820856\"></a></p>","fields":{"slug":"/background-1/"},"frontmatter":{"tags":["python","data"],"title":"background tasks in python","description":"none","templateKey":"blog-post","status":"draft","date":"2017-09-16T00:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABldOWNo2g/8QAGhAAAgIDAAAAAAAAAAAAAAAAARIAAgMhIv/aAAgBAQABBQIKYphpAqC2sp6//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAICAwAAAAAAAAAAAAAAAAEQADEyUXH/2gAIAQEABj8CG+SlgH//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhQVFh/9oACAEBAAE/IZ2TcKCNapGnDREYeThi+o//2gAMAwEAAgADAAAAEFDv/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAh/9oACAEDAQE/EKC//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QZ//EABwQAQEAAgMBAQAAAAAAAAAAAAERACExUWGBkf/aAAgBAQABPxASBlVJ3xmuBbXzLNUX24bUrRDzIbFp5/MQYDS8b+95/9k=","width":500,"height":335,"src":"/static/7d7fa9d9a34c2456883afe754bba831d/0f3a1/gabriele-diwald-199200-unsplash.jpg","srcSet":"/static/7d7fa9d9a34c2456883afe754bba831d/0f3a1/gabriele-diwald-199200-unsplash.jpg 1x,\n/static/7d7fa9d9a34c2456883afe754bba831d/f9913/gabriele-diwald-199200-unsplash.jpg 1.5x,\n/static/7d7fa9d9a34c2456883afe754bba831d/a7715/gabriele-diwald-199200-unsplash.jpg 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABFpkjbMQP/8QAHBAAAQMFAAAAAAAAAAAAAAAAAQIDMQAREiIy/9oACAEBAAEFAksuWwBpWpHAh2f/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAQUAAAAAAAAAAAAAAAAAAAECICFx/9oACAEBAAY/ArdFMP/EAB0QAQACAQUBAAAAAAAAAAAAAAEAESExUXGhscH/2gAIAQEAAT8hBcUM1A7vCU4mpwzw+zrJ/9oADAMBAAIAAwAAABCo7//EABcRAQADAAAAAAAAAAAAAAAAAAABETH/2gAIAQMBAT8QzK3/xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8QNX//xAAeEAACAQQDAQAAAAAAAAAAAAAAAREhMUHwUWFx0f/aAAgBAQABPxCF+nUXwbUJMpWK+EM4zZm+4LRa7s//2Q==","width":200,"height":85,"src":"/static/7d7fa9d9a34c2456883afe754bba831d/a6613/gabriele-diwald-199200-unsplash.jpg","srcSet":"/static/7d7fa9d9a34c2456883afe754bba831d/a6613/gabriele-diwald-199200-unsplash.jpg 1x,\n/static/7d7fa9d9a34c2456883afe754bba831d/b97e6/gabriele-diwald-199200-unsplash.jpg 1.5x,\n/static/7d7fa9d9a34c2456883afe754bba831d/eeb4b/gabriele-diwald-199200-unsplash.jpg 2x"}}}}},"similarPosts":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}},"staticQueryHashes":["2992646504"]}
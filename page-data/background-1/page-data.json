{"componentChunkName":"component---src-templates-blog-post-js","path":"/background-1/","result":{"data":{"markdownRemark":{"id":"2323e978-45ff-5c4a-be68-3d9c65343212","html":"<h1>background tasks in python</h1>\n<p>I have tried most of the different methods in the past and found that copying and pasting the <a href=\"https://docs.python.org/3/library/concurrent.futures.html#threadpoolexecutor-example\">threadpoolexecutor example</a> or the <a href=\"https://docs.python.org/3/library/concurrent.futures.html#processpoolexecutor-example\">processpoolexecutor example</a> from the standard library documentation to be the most reliable.  Since this is often something that I stuff in the back of a utility module of a library it is not something that I write often enough to be familiar with, which makes it both hard to write and hard to read and debug.  If you are looking for a good overview of the difference concurrency <a href=\"https://twitter.com/raymondh\">Raymond Hettinger</a> has a great talk about the difference between the various different methods, when to use them and why.</p>\n<p>Recently a new python library was released to make running tasks in the background very simple. The <a href=\"https://github.com/kennethreitz/background\">background</a> project by Kenneth Reitz is a high level implementation of python 3's ThreadPoolExecutor.  I have been playing around with this project over the last week and I will say that this is definitely the simplest way to run background tasks in python by far.  It really simplifes the syntax and lets me focus on my job rather than implementing custom concurrent code that is more difficult to debug.</p>\n<h2>Background</h2>\n<p>I have pulled the latest version of the project in Sept 2017.  I found that it had some updates that were important to pass *args and **kwargs compared to the pypi version.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> background <span class=\"token keyword\">as</span> bg\n\n<span class=\"token operator\">%</span>load_ext watermark\n<span class=\"token operator\">%</span>watermark <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>v <span class=\"token operator\">-</span>p background</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2017-09-16\n\nCPython 3.6.2\nIPython 6.1.0\n\nbackground n\u0007</code></pre></div>\n<h2>Define Worker Functions</h2>\n<p>Each of these worker functions takes 1s to run, simulating a moderately long calculation that we need to do many times over.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">work</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n\n<span class=\"token decorator annotation punctuation\">@bg<span class=\"token punctuation\">.</span>task</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">bg_work</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span></code></pre></div>\n<h2>Run the Worker Functions</h2>\n<h2>Blocking function</h2>\n<p>This function is blocking each time the function runs, thus taking 1 second to run for each calculation.  The example below took exactly <strong>100 s</strong> to run 100 calculations.  Depending on your use case this may not be fast enough.  If the calculations do not rely on the global state</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span><span class=\"token operator\">%</span>time\n<span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    work<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Wall time: 1min 40s</code></pre></div>\n<h3>Reaction</h3>\n<p>I  know what half of you are saying to yourselfs..</p>\n<blockquote>\n<p>   !!What!! that took 100 s, by now my users have already sent a dozen messages and filed an issue that my feature is down</p>\n</blockquote>\n<p>and the other half</p>\n<blockquote>\n<p>Seriously that wasnt even enough time to grab a coffee.  Any real time consuming analysis takes at least 3 dats 14 hours 159 seconds before I start to care about concurrency</p>\n</blockquote>\n<p>To you I say... I am impatient and I got other things to do rather than wait on this maching to finish its work.  Let's get into this concurrency stuff.</p>\n<h2>Background Function</h2>\n<p>This function spins off worker processes and runs much faster.  By default background sets the number of processes to the number of cpu cores available, Therefore this function should run in n/4 + (inefficiency).  Here we see that the result is just over <strong>13 s</strong>.</p>\n<p>Note:<em>Since there is a bit of inefficiency added by needing to handle all of the threads it is not exactly divided by the number of workers.</em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span><span class=\"token operator\">%</span>time\nf_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>bg_work<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> <span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> f <span class=\"token keyword\">in</span> f_list<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Wall time: 13.1 s</code></pre></div>\n<h3>Reaction</h3>\n<p>I know what your saying this time.</p>\n<blockquote>\n<p>really a 7.6x improvement...  Is that really even woth the extra work.</p>\n</blockquote>\n<p>Fine then lets crank it up to 11!</p>\n<h3>Lots of Background</h3>\n<p>lets set the number of background processes to a value just higher to than the number of workers we need to run in order to start them all simultaneously. With this simple example that is not very CPU intensive we see the result is just over the amount of time that it takes to run 1 worker.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">bg<span class=\"token punctuation\">.</span>n <span class=\"token operator\">=</span> <span class=\"token number\">110</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span><span class=\"token operator\">%</span>time\nf_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>bg_work<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token keyword\">not</span> <span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>f<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> f <span class=\"token keyword\">in</span> f_list<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">pass</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Wall time: 1.09 s</code></pre></div>\n<h3>Reaction</h3>\n<blockquote>\n<p>91x improvement by putting my calculations into a function, adding a decorator, and some checks, im in.</p>\n</blockquote>\n<h2>On Tap</h2>\n<p>This week while taking it up to 11 I was enjoying a super thick and rich cup of El Salvador Finca Rosa from Onyx Coffee Labs.  Check out their love for letting the bean speak for it self and producing a great cup.</p>\n<p><a href=\"https://onyxcoffeelab.com\"><img src=\"https://cdn.shopify.com/s/files/1/1707/3261/files/coffee_science.png?5305428688827820856\"></a></p>","fields":{"slug":"/background-1/"},"frontmatter":{"date":"2017-09-16T00:00:00.000Z","title":"background tasks in python","description":"none","status":"draft","cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/src/pages/gabriele-diwald-199200-unsplash.jpg","xsm_img":{"fixed":{"src":"/static/7d7fa9d9a34c2456883afe754bba831d/2c7f8/gabriele-diwald-199200-unsplash.jpg","srcWebp":"/static/7d7fa9d9a34c2456883afe754bba831d/f6b6d/gabriele-diwald-199200-unsplash.webp"}},"sm_img":{"fixed":{"src":"/static/7d7fa9d9a34c2456883afe754bba831d/9dc27/gabriele-diwald-199200-unsplash.jpg","srcWebp":"/static/7d7fa9d9a34c2456883afe754bba831d/403a4/gabriele-diwald-199200-unsplash.webp"}},"med_img":{"fixed":{"src":"/static/7d7fa9d9a34c2456883afe754bba831d/0f3a1/gabriele-diwald-199200-unsplash.jpg","srcWebp":"/static/7d7fa9d9a34c2456883afe754bba831d/e9589/gabriele-diwald-199200-unsplash.webp"}},"full":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECA//EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAZqRrgB//8QAGBAAAwEBAAAAAAAAAAAAAAAAAQIRAyH/2gAIAQEAAQUCXCCKQ/D/AP/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ASf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAQERP/2gAIAQEABj8CdD//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAhMVH/2gAIAQEAAT8hBaFXsBhrIQWOcn//2gAMAwEAAgADAAAAEP8A7//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAwEBPxCSv//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxA1f//EAB0QAAICAQUAAAAAAAAAAAAAAAERADFBIWFxgcH/2gAIAQEAAT8QL3IFGx3LkiCeN47mhA08vmf/2Q==","width":1000,"height":420,"src":"/static/7d7fa9d9a34c2456883afe754bba831d/9cf42/gabriele-diwald-199200-unsplash.jpg","srcSet":"/static/7d7fa9d9a34c2456883afe754bba831d/9cf42/gabriele-diwald-199200-unsplash.jpg 1x,\n/static/7d7fa9d9a34c2456883afe754bba831d/55395/gabriele-diwald-199200-unsplash.jpg 1.5x,\n/static/7d7fa9d9a34c2456883afe754bba831d/5858b/gabriele-diwald-199200-unsplash.jpg 2x"},"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECA//EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAZqRrgB//8QAGBAAAwEBAAAAAAAAAAAAAAAAAQIRAyH/2gAIAQEAAQUCXCCKQ/D/AP/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ASf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAQERP/2gAIAQEABj8CdD//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAhMVH/2gAIAQEAAT8hBaFXsBhrIQWOcn//2gAMAwEAAgADAAAAEP8A7//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAwEBPxCSv//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxA1f//EAB0QAAICAQUAAAAAAAAAAAAAAAERADFBIWFxgcH/2gAIAQEAAT8QL3IFGx3LkiCeN47mhA08vmf/2Q==","aspectRatio":2.380952380952381,"src":"/static/7d7fa9d9a34c2456883afe754bba831d/9cf42/gabriele-diwald-199200-unsplash.jpg","srcSet":"/static/7d7fa9d9a34c2456883afe754bba831d/ff9d4/gabriele-diwald-199200-unsplash.jpg 250w,\n/static/7d7fa9d9a34c2456883afe754bba831d/2dc04/gabriele-diwald-199200-unsplash.jpg 500w,\n/static/7d7fa9d9a34c2456883afe754bba831d/9cf42/gabriele-diwald-199200-unsplash.jpg 1000w,\n/static/7d7fa9d9a34c2456883afe754bba831d/55395/gabriele-diwald-199200-unsplash.jpg 1500w,\n/static/7d7fa9d9a34c2456883afe754bba831d/5858b/gabriele-diwald-199200-unsplash.jpg 2000w,\n/static/7d7fa9d9a34c2456883afe754bba831d/d6a6c/gabriele-diwald-199200-unsplash.jpg 3799w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"2323e978-45ff-5c4a-be68-3d9c65343212","prev":{"id":"362278e4-41d7-5211-8b3d-cea698a1887b","html":"<p>Nesting loops inside of each other in python makes for much harder code to understand, it takes more brain power to understand, and is thus more error prone than if its avoidable.  One issue with this complexity is that toy examples may make sense, but most real example will grow and become more deeply nested over time.  Avoiding this complexity from the start can help simplify the project in the future.</p>\n<h2>setup</h2>\n<p>Lets take a pretty simple example where we are using a ficticious library to get some sales data for our transportation company.  The api allows us to fetch teh sales data for one class of vehicle and one region at a time.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n\n<span class=\"token keyword\">from</span> datastore <span class=\"token keyword\">import</span> get_sales  <span class=\"token comment\"># ficticious library</span>\n\ncars <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span>\nregions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'US'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>❌ Nesting Loops</h2>\n<p>We have setup to fetch our data with two lists that represent the vehicles and regions that we want to analyze.  We know that we need to make a call to <code class=\"language-text\">get_sales</code> for every vehicle and region so nesting loops is a very common first solution to jump to.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> car <span class=\"token keyword\">in</span> cars<span class=\"token punctuation\">:</span>\n   <span class=\"token keyword\">for</span> region <span class=\"token keyword\">in</span> regions<span class=\"token punctuation\">:</span>\n      new_sales <span class=\"token operator\">=</span> get_sales<span class=\"token punctuation\">(</span>car<span class=\"token punctuation\">,</span> region<span class=\"token punctuation\">)</span>\n      sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>sales<span class=\"token punctuation\">,</span> new_sales<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>itertools.product</h2>\n<p>Python provides us with the beautiful itertools module that allows us to prepare our inputs for this in a much more susynct manner.  The product function of itertools will give us every combination of any number of iterables</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> itertools\n<span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> regions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>note that itertools returns a generator for most if not all functions, list() will turn that into a list that we can see.  This works great for small datasets, but might not be advisable on larger ones.</p>\n</blockquote>\n<p><strong>output</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'US'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'US'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'US'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">(</span><span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>itertools.procuct for loop</h2>\n<p>Now that we have every comination of our two sets of inputs in a single list, we can iterate over that list one time.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> car<span class=\"token punctuation\">,</span> region <span class=\"token keyword\">in</span> itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> regions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   new_sales <span class=\"token operator\">=</span> get_sales<span class=\"token punctuation\">(</span>car<span class=\"token punctuation\">,</span> region<span class=\"token punctuation\">)</span>\n   sales <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>sales<span class=\"token punctuation\">,</span> new_sales<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>itertools.product list comprehension</h2>\n<p>The above follows a python anti-pattern, initialize then edit.  In some cases it might be a bit more readable to do it that way, you can be the judge, but in our simple case we can simply achieve the same results using a list comprehension.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>get_sales<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> region<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> cars<span class=\"token punctuation\">,</span> region <span class=\"token keyword\">in</span> itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span>cars<span class=\"token punctuation\">,</span> regions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>dictionaries</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales_args <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token string\">'cars'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">'regions'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'US'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\npd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>get_sales<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_arg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> sales_arg <span class=\"token keyword\">in</span> itertools<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_args<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">sales_args <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token string\">'cars'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">'regions'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'US'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CA'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MX'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">'month'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'MAR'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'APR'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MAY'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\npd<span class=\"token punctuation\">.</span>concat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>get_sales<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_arg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> sales_arg <span class=\"token keyword\">in</span> product<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>sales_args<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<hr>\n<h2>Chaining</h2>\n<p><em>containers of containers</em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">vehicles <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token string\">'cars'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sedan'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'coupe'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hatchback'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'trucks'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'light'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'heavy'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sport'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'offroad'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'van'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'box'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mini'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'full'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">for vehicle in vehicles:\n\tfor sub_class in vehicles[vehicle]:\n      new_sales = get_sales(sub_class)\n      new_sales[&#39;sub_class&#39;] = sub_class\n      new_sales[&#39;vehicle&#39;] = vehicle\n      sales = pd.concat([sales, new_sales])</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> list(itertools.chain(*[list(itertools.product([k], v)) for k, v in vehicles.items()]))</code></pre></div>\n<p>output</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[(&#39;cars&#39;, &#39;sedan&#39;),\n (&#39;cars&#39;, &#39;coupe&#39;),\n (&#39;cars&#39;, &#39;hatchback&#39;),\n (&#39;trucks&#39;, &#39;light&#39;),\n (&#39;trucks&#39;, &#39;heavy&#39;),\n (&#39;trucks&#39;, &#39;sport&#39;),\n (&#39;trucks&#39;, &#39;offroad&#39;),\n (&#39;van&#39;, &#39;box&#39;),\n (&#39;van&#39;, &#39;mini&#39;),\n (&#39;van&#39;, &#39;full&#39;)]</code></pre></div>","fields":{"slug":"/avoid-nesting-loops-in-python/"},"frontmatter":{"tags":[],"title":"Avoid Nesting Loops in Python","description":"Nesting loops inside of each other in python makes for much harder code to understand, it takes more brain power to unde","templateKey":"blog-post","status":"draft","date":"2020-10-11T05:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABgklEQVQY032RyUoDQRCGc/cWE81kmSTTMbP0Vp1ZMqOdONFEXHC/aUBF9CAGPLggelAU9Al8E9/PmoAXD8JPU930X/X137lqS6EMoqpEVVowXbGWBsqS9QXfoUtCpEL0JGiuNMhEqEWpYqmiXBmdmRlKlsS6RGC+KUrTbb0duTQ12wHly1T0GddCag5LXCYMugKm5jKB6oKq2X6hzrCL6YTFOps1adlSxI7nTO56mstl1Rm4XtdjXQ4JhzgzVwgUCBhOdPv4enXzuHU4vn9+Pzq7upzcbewfjy8ml9d3u3snB4en9w8vT8/vZ+fXiM1xsurm8hbwmhdZrB2kEA8JS2zQLBzQIHU7fRkPIRl1wlEQjnRvc7C6o/vriJ1Nxjc3HPj+fPs4mcxU3KJJ5xocmQsmimbwNZqveVXSobzn0UXnFxsDy7CFlF8P461kO2+y8jS5P8pSxPDsQMk08YdpuNYLVrW/QuwgV2wKo0GNJscb/2i+KTFXyw5bbtSwffxIPPkBvu5dZCkdmSUAAAAASUVORK5CYII=","width":500,"height":210,"src":"/static/83aa845b95a47f9f95ad621e6a3f2555/46604/avoid-nesting-loops-in-python-xmas2020.png","srcSet":"/static/83aa845b95a47f9f95ad621e6a3f2555/46604/avoid-nesting-loops-in-python-xmas2020.png 1x,\n/static/83aa845b95a47f9f95ad621e6a3f2555/d8815/avoid-nesting-loops-in-python-xmas2020.png 1.5x,\n/static/83aa845b95a47f9f95ad621e6a3f2555/31987/avoid-nesting-loops-in-python-xmas2020.png 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwUlEQVQoz32Q227TQBCGfcsVLWlDfIgjsl6f1rs7aztO4kOcpkBQmoJaSipQ1HKQEkQhEQeposAFF7wAt0i8C2/GOiAukX6N/hnNpzkoJg5NDJotmpYwbWhaoW6BgcC0mIqhhYRLUmB7lJdACwEZDYuIpTzsA/QV3RKyW7WEhkAaHYFmgfQa4g3E1TY3ceSRnLKSsYLxjEIOPGWiz6CnaJZQEUg1JIBDmTbaXK2KVd3xBy4ZtJyYsWHABpQVHAoucsr7QQVvyApu8y3N3TGJ5KW5YXjXNbuFk5tNtmMQz889kgU0w04H26GE6V/YjnYRfLj6ulxdHj1+8XJ1+eb9pyfPL2ZnywenT8+X6/mz19PD+fzs1Wr98fOXb4vFWsRFwLtKHQmtgbHhdkeH5fg4yu/5UTmanCTlpLh7FOXj/YNHw/Fxlk8H5f3J5PThyfnBdMZFVk2uI/5j9fb7fHFNc+SqtSbZbQVy7VrT39a9mkm2dFeqbSckyB2vi50YezFhPZ8nSifkv35evZtdbOvy2ury6mGbF2wi/PMOSWOx1wtHRXwni/aHnduKYbE8Btvi9Vv8D/kfITehNBO8oCx1/O5vKF5qEf5ulMgAAAAASUVORK5CYII=","width":200,"height":85,"src":"/static/83aa845b95a47f9f95ad621e6a3f2555/71e30/avoid-nesting-loops-in-python-xmas2020.png","srcSet":"/static/83aa845b95a47f9f95ad621e6a3f2555/71e30/avoid-nesting-loops-in-python-xmas2020.png 1x,\n/static/83aa845b95a47f9f95ad621e6a3f2555/24123/avoid-nesting-loops-in-python-xmas2020.png 1.5x,\n/static/83aa845b95a47f9f95ad621e6a3f2555/492a0/avoid-nesting-loops-in-python-xmas2020.png 2x"}}}}},"next":{"id":"3f3371e3-1f9b-5ebc-bae5-4646a485c741","html":"<h1>Bash Notes</h1>\n<p>Bash is super powerful.</p>\n<h2>File System Full</h2>\n<p><strong>Show Remaining Space on Drives</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">df</span> -h</code></pre></div>\n<p><strong>show largest files in current directory</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">du</span> <span class=\"token builtin class-name\">.</span> -h --max-depth<span class=\"token operator\">=</span><span class=\"token number\">1</span></code></pre></div>\n<p><strong>Move files then symlink them</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /mnt/mounted_drive\n<span class=\"token function\">mv</span> ~/bigdir /mnt/mounted_drive\n<span class=\"token function\">ln</span> -s /mnt/mounted_drive/bigdir ~/bigdir</code></pre></div>\n<h2>Fuzzy One Liners</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>source activate \"<span class=\"token punctuation\">$(</span>conda info --envs <span class=\"token operator\">|</span> fzf <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> '<span class=\"token punctuation\">{</span>print $</code></pre></div>\n<p><strong>edit in vim</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">vf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> fzf <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -r -I % <span class=\"token variable\">$EDITOR</span> % <span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>cat a file</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">vf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> fzf <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -r -I % <span class=\"token variable\">$EDITOR</span> % <span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>bash execute</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">bf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">bash</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>fzf<span class=\"token variable\">)</span></span>\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>git add</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">gadd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">git</span> status -s <span class=\"token operator\">|</span> fzf -m <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{print <span class=\"token variable\">$2</span>}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> status -s<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>git reset</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">greset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">git</span> status -s <span class=\"token operator\">|</span>  fzf -m <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{print <span class=\"token variable\">$2</span>}'</span> <span class=\"token operator\">|</span><span class=\"token function\">xargs</span> <span class=\"token function\">git</span> reset <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> status -s<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Kill a process</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">fkill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>kill <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ps</span> aux <span class=\"token operator\">|</span> fzf <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{print(<span class=\"token variable\">$2</span>)}'</span><span class=\"token variable\">)</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Finding things</h2>\n<h3>Files</h3>\n<p><a href=\"https://github.com/sharkdp/fd\">fd-find</a> is amazing for finding files, it even respects your <code class=\"language-text\">.gitignore</code> file 😲.  Install with <code class=\"language-text\">apt install fd-find</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">fd md</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ag -g python</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> -n <span class=\"token string\">\"*.md\"</span></code></pre></div>\n<p><em>++Vanilla Bonus</em></p>\n<h3>Content</h3>\n<p>** show matching text **</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ag python</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">grep</span> -iR Python</code></pre></div>\n<p><em>++Vanilla Bonus</em></p>\n<p>** show file names only **</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ag -l python</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">grep</span> -iRl python</code></pre></div>\n<p><em>++Vanilla Bonus</em></p>\n<h3>Recursively Replace text</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">agr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>ag -l <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s/<span class=\"token variable\">$1</span>/<span class=\"token variable\">$2</span>/g\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>++Vanilla Bonus</em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">grepr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>grep -iRl <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s/<span class=\"token variable\">$1</span>/<span class=\"token variable\">$2</span>/g\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Extending</strong> <code class=\"language-text\">**agr**</code> <strong>or</strong> <code class=\"language-text\">**grepr**</code></p>\n<p>There are so many options inside of <code class=\"language-text\">grep</code>, <code class=\"language-text\">ag</code>, and <code class=\"language-text\">sed</code> that you could many an enormous amount of these if you really wanted to, but I like to keep it simple.  These cover 90% of my usage.  If I wanted to change something in the second half I would just paste in this command and edit it. More often though I want to limit the input, say only replace word1 to word2 inside of markdown files.</p>\n<p><strong>Limited Scope</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">fd md <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> argr python python3</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> -n <span class=\"token string\">\"*.md\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> grepr python python3</code></pre></div>\n<p><em>++Vanilla Bonus</em></p>\n<a class=\"onelinelink\" href=\"https://waylonwalker.com/refactor-in-cli/\">\n<img style=\"float: right;\" align=\"right\" src=\"https://waylonwalker.com/static/caee54c45632d974fe802bdbb34f8b54/630fb/refactor-in-cli-xmas2020.png\" alt=\"article cover for Large Refactor At The Command Line\">\n<div class=\"right\">\n    <h2>Large Refactor At The Command Line</h2>\n    <p class=\"description\">\n    As projects grow patterns that worked early on break and we need to change things to make the project easier to work wit\n    </p>\n    <p class=\"url\">\n    <span class=\"read-more\">read more</span>  waylonwalker.com\n    </p>\n</div>\n</a>\n<blockquote>\n<p>I use these replace commands heavily when doing large refactorings.</p>\n</blockquote>\n<h3>conditionally configure</h3>\n<p>I like this one when there is not a good cli into config files and I need to replace something like a true to false if the value is in the config and append to the config if its not.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">grepr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># replaces first string with second string inside file from third argument</span>\n    <span class=\"token comment\"># example:</span>\n    <span class=\"token comment\">#   grepr \"allow_conda_downgrades:.*\" \"allow_conda_downgrades: true\" ~/.condarc</span>\n    <span class=\"token keyword\">if</span> <span class=\"token function\">grep</span> -xq <span class=\"token variable\">$1</span> <span class=\"token variable\">$3</span>\n    <span class=\"token keyword\">then</span>\n        <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s|<span class=\"token variable\">$1</span>|<span class=\"token variable\">$2</span>|g\"</span> <span class=\"token variable\">$3</span>\n    <span class=\"token keyword\">else</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$2</span>\"</span> <span class=\"token operator\">>></span> <span class=\"token variable\">$3</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Watch the time</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">watch</span> -n <span class=\"token number\">1</span> <span class=\"token function\">date</span></code></pre></div>\n<p><em>++Vanilla Bonus</em></p>\n<p><strong>with figlet</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">watch</span> -n <span class=\"token number\">1</span> <span class=\"token function\">bash</span> -c <span class=\"token string\">\"date | figlet\"</span></code></pre></div>\n<h3>watch a function</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">run</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token function\">date</span>\naws s3 <span class=\"token function\">sync</span> <span class=\"token variable\">$BUCKET</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token builtin class-name\">export</span> -f run\n<span class=\"token function\">watch</span> -n <span class=\"token number\">10</span> run</code></pre></div>\n<h3>if conda environment does not exist create it</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">conda info --envs <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> my_env <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"my_env environment is installed\"</span> <span class=\"token operator\">||</span> conda create -n my_env <span class=\"token assign-left variable\">python</span><span class=\"token operator\">=</span><span class=\"token number\">3.8</span> -y\n<span class=\"token builtin class-name\">source</span> activate my_env</code></pre></div>\n<h1>Rename multiple files</h1>\n<p>more info from <a href=\"https://linuxize.com/post/how-to-rename-files-in-linux/\">linuxize</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">f</span> <span class=\"token keyword\">in</span> *.png<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span>\n   <span class=\"token function\">mv</span> <span class=\"token variable\">${f}</span> prefix-<span class=\"token variable\">${f}</span>\n<span class=\"token keyword\">done</span></code></pre></div>\n<h2>convert all files in a directory to unix</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dos2unix **/*</code></pre></div>\n<h2>recursively remove all whitespace from .py files</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">find</span> **/*.py -type f -exec <span class=\"token function\">sed</span> -i <span class=\"token string\">'s/ *$//'</span> <span class=\"token string\">'{}'</span> <span class=\"token string\">';'</span></code></pre></div>\n<h2>recursively autopep8</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">find <span class=\"token punctuation\">.</span> <span class=\"token operator\">-</span>name <span class=\"token string\">'*.py'</span> <span class=\"token operator\">-</span><span class=\"token keyword\">exec</span> autopep8 <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token keyword\">in</span><span class=\"token operator\">-</span>place <span class=\"token string\">'{}'</span> \\<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>make bash script a runnable command</h2>\n<p>include a shebang</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#! /bin/bash</span></code></pre></div>\n<p>chmod</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">chmod</span> +x /usr/local/bin/my_script</code></pre></div>\n<p>accept positional input</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#! /bin/bash</span>\n<span class=\"token assign-left variable\">input</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\n<span class=\"token builtin class-name\">echo</span> input</code></pre></div>\n<h1>Using pyp</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pipx <span class=\"token function\">install</span> pyp</code></pre></div>\n<h2>replacement for cut</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">❯ python -m http.server <span class=\"token number\">5000</span> <span class=\"token operator\">&amp;</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token number\">8574</span>\n\n✦ ❯ Serving HTTP on <span class=\"token number\">0.0</span>.0.0 port <span class=\"token number\">5000</span> <span class=\"token punctuation\">(</span>http://0.0.0.0:5000/<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.\n\n✦ ❯ <span class=\"token function\">ps</span> aux <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"python -m http.server\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -v <span class=\"token function\">grep</span> <span class=\"token operator\">|</span> pyp <span class=\"token string\">'line.split()[1]'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">kill</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>  + terminated  python -m http.server <span class=\"token number\">5000</span></code></pre></div>\n<h2>replacement for wc</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">conda info --envs <span class=\"token operator\">|</span> pyp <span class=\"token string\">'len(lines) - 3 # account for header and base'</span></code></pre></div>\n<h2>print contents of shell function</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">declare</span> -f <span class=\"token operator\">&lt;</span>function-name<span class=\"token operator\">></span></code></pre></div>\n<h2>batch rename files</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">f</span> <span class=\"token keyword\">in</span> *.jpeg<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span>\n    <span class=\"token function\">mv</span> -- <span class=\"token string\">\"<span class=\"token variable\">$f</span>\"</span> <span class=\"token string\">\"<span class=\"token variable\">${f<span class=\"token operator\">%</span>.jpeg}</span>.jpg\"</span>\n<span class=\"token keyword\">done</span></code></pre></div>\n<h2>convert markdown files to reveal.js</h2>\n<p><a href=\"https://github.com/jgm/pandoc/wiki/Using-pandoc-to-produce-reveal.js-slides\">https://github.com/jgm/pandoc/wiki/Using-pandoc-to-produce-reveal.js-slides</a>\ninstall pandoc</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> pandoc</code></pre></div>\n<p>setup</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://github.com/hakimel/reveal.js/archive/master.tar.gz\n<span class=\"token function\">tar</span> -xzvf master.tar.gz\n<span class=\"token function\">mv</span> reveal.js-master reveal.js</code></pre></div>\n<p>convert</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pandoc -t revealjs -s -o myslides.html myslides.md -V revealjs-url<span class=\"token operator\">=</span>https://unpkg.com/reveal.js@3.9.2/</code></pre></div>\n<h2>Render Markdown at the command line</h2>\n<p><a href=\"https://github.com/charmbracelet/glow\">Glow</a> is a terminal markdown renderer written in go.  There iis a prebuilt binary that can simply be unzipped and executed to render markdow.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://github.com/charmbracelet/glow/releases/download/v0.2.0/glow_0.2.0_linux_x86_64.tar.gz\n<span class=\"token function\">tar</span> -xzf glow_0.2.0_linux_x86_64.tar.gz\n<span class=\"token function\">chmod</span> +x glow\n<span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> glow /usr/bin\n\nglow <span class=\"token operator\">&lt;</span>filename<span class=\"token operator\">></span></code></pre></div>\n<h2>Autocomplete for click applications</h2>\n<p>see the <a href=\"https://click.palletsprojects.com/en/7.x/bashcomplete/\">docs</a> for more details</p>\n<h2>Autocomplete for non click python cli's</h2>\n<p>shtab <a href=\"https://github.com/iterative/shtab\" title=\"https://github.com/iterative/shtab\">https://github.com/iterative/shtab</a></p>\n<h2>Ensure functions reset context</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">project_log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token assign-left variable\">_dir</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>\n   <span class=\"token function-name function\">_project_log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin class-name\">cd</span> ~/projects/project\n      <span class=\"token function\">git</span> log\n   <span class=\"token punctuation\">}</span>\n   _project_log <span class=\"token variable\">$@</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$_dir</span> <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$_dir</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","fields":{"slug":"/bash/"},"frontmatter":{"tags":["python","cli"],"title":"Bash","description":"Waylon Walker's Bash Notes","templateKey":"blog-post","status":"published","date":"2019-09-08T05:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeMQQ0f/xAAYEAADAQEAAAAAAAAAAAAAAAAAARECEP/aAAgBAQABBQLOGzSdLC8//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAARAhEQD/2gAIAQEABj8Cg09Rij//xAAcEAEAAgEFAAAAAAAAAAAAAAABABExECFBYXH/2gAIAQEAAT8hBpeibRcONB5E8is3Ln//2gAMAwEAAgADAAAAENQP/8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQMBAT8Qh//EABURAQEAAAAAAAAAAAAAAAAAABBB/9oACAECAQE/EKf/xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMUFR/9oACAEBAAE/EEbilBVr3kOyADCIRKY1aP1VNiSrrfYp2f/Z","width":500,"height":333,"src":"/static/c4381601d570bb796e3fceb606b40e06/0f3a1/hannah-gibbs-BINLgyrG_fI-unsplash.jpg","srcSet":"/static/c4381601d570bb796e3fceb606b40e06/0f3a1/hannah-gibbs-BINLgyrG_fI-unsplash.jpg 1x,\n/static/c4381601d570bb796e3fceb606b40e06/f9913/hannah-gibbs-BINLgyrG_fI-unsplash.jpg 1.5x,\n/static/c4381601d570bb796e3fceb606b40e06/a7715/hannah-gibbs-BINLgyrG_fI-unsplash.jpg 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAcmFJIg//8QAGBAAAwEBAAAAAAAAAAAAAAAAAQIRACD/2gAIAQEAAQUCULjLx//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAEFAAAAAAAAAAAAAAAAAAEAESAhIv/aAAgBAQAGPwLRYKo//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAERUSEx/9oACAEBAAE/IXON2lFtVWsgh+DP/9oADAMBAAIAAwAAABAkD//EABYRAQEBAAAAAAAAAAAAAAAAABEQIf/aAAgBAwEBPxBwn//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EIf/xAAdEAACAgIDAQAAAAAAAAAAAAAAARFBITFhcYHB/9oACAEBAAE/EMxBlpTwKzVKIb8HB0fBs7Nj/9k=","width":200,"height":85,"src":"/static/c4381601d570bb796e3fceb606b40e06/a6613/hannah-gibbs-BINLgyrG_fI-unsplash.jpg","srcSet":"/static/c4381601d570bb796e3fceb606b40e06/a6613/hannah-gibbs-BINLgyrG_fI-unsplash.jpg 1x,\n/static/c4381601d570bb796e3fceb606b40e06/b97e6/hannah-gibbs-BINLgyrG_fI-unsplash.jpg 1.5x,\n/static/c4381601d570bb796e3fceb606b40e06/eeb4b/hannah-gibbs-BINLgyrG_fI-unsplash.jpg 2x"}}}}},"similarPosts":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}},"staticQueryHashes":["2992646504"]}
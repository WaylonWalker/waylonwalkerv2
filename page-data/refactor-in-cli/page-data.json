{"componentChunkName":"component---src-templates-blog-post-js","path":"/refactor-in-cli/","result":{"data":{"markdownRemark":{"id":"eaf5184f-bfba-58a7-a09c-1a2ffcbb6ddc","html":"<p>As projects grow patterns that worked early on break and we need to change things to make the project easier to work with, and more welcoming to new developers.</p>\n<h2>git</h2>\n<p>Before you start mucking up a project with wild commands at the terminal check that you have a super clean git status. We may make some mistakes and need a way to undo 100's files and git makes it really easy if you start with a clean history.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> status</code></pre></div>\n<p>If we are ready to begin work we should see a response like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">On branch main\nnothing to commit, working tree clean</code></pre></div>\n<p>It would also be wise to do this inside of a branch.  The minute you try to do something wild in your working branch someone will walk by and ask you to do a five-minute task, but your deep in refactoring and haven't left yourself a clean way back.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> branch my-big-refactor</code></pre></div>\n<h2>grepr</h2>\n<p>Time for the meat of this refactor replacing text across our project.  I often will pop this bash function into my terminal session and tweak it as needed. This function is called <code class=\"language-text\">grepr</code> for <code class=\"language-text\">grep</code> then <code class=\"language-text\">replace</code>.  It will recursively search for a given pattern inside your working directory, then use <code class=\"language-text\">sed</code> to replace that pattern with another.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">grepr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>grep -iRl <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s/<span class=\"token variable\">$1</span>/<span class=\"token variable\">$2</span>/g\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>If your pattern contains <code class=\"language-text\">/</code> characters such as for URLs you can swap the <code class=\"language-text\">/</code>'s in the <code class=\"language-text\">sed</code> command for <code class=\"language-text\">|</code>'s.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">grepr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>grep -iRl <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s|<span class=\"token variable\">$1</span>|<span class=\"token variable\">$2</span>|g\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can find this function and more of my bash notes.</p>\n<a class=\"onelinelink\" href=\"https://waylonwalker.com/bash/\">\n<img style=\"float: right;\" align=\"right\" src=\"https://waylonwalker.com/static/c4381601d570bb796e3fceb606b40e06/9dc27/hannah-gibbs-BINLgyrG_fI-unsplash.jpg\" alt=\"article cover for Bash\">\n<div class=\"right\">\n    <h2>Bash</h2>\n    <p class=\"description\">\n    Waylon Walker&apos;s Bash Notes\n    </p>\n    <p class=\"url\">\n    <span class=\"read-more\">read more</span>  waylonwalker.com\n    </p>\n</div>\n</a>\n<h2>Example</h2>\n<p>I recently flattened this blog so blogs are under the top-level rather than under <code class=\"language-text\">/blog</code> and I used this technique to swap internal links to the new format.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">grepr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>grep -iRl <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s|<span class=\"token variable\">$1</span>|<span class=\"token variable\">$2</span>|g\"</span><span class=\"token punctuation\">}</span>\n\n\ngrepr <span class=\"token string\">\"https://waylonwalker.com/blog/\"</span> <span class=\"token string\">\"https://waylonwalker.com/\"</span></code></pre></div>\n<h2>git diff</h2>\n<p>After running the replace command the first thing I want to see is everything that changed.  Looking at git diff will highlight exactly what changed since our last commit.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">diff</span></code></pre></div>\n<h2>Work in small steps</h2>\n<p>If you're happy with the results commit them now.  It's best to do these commands that have a large effect on the entire project in small steps.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">git</span> commit -m <span class=\"token string\">\"moved routes from /blog to /\"</span></code></pre></div>\n<p>Working in small steps gives us an easy way to undo steps that may have been a mistake before it's too late.</p>\n<a class=\"onelinelink\" href=\"https://waylonwalker.com/master-no-more/\">\n<img style=\"float: right;\" align=\"right\" src=\"https://waylonwalker.com/static/656b0f429bd13770249a8e39f7dee184/630fb/master-no-more-xmas2020.png\" alt=\"article cover for Master No More\">\n<div class=\"right\">\n    <h2>Master No More</h2>\n    <p class=\"description\">\n    It&apos;s been a long time coming.  We use some very harsh language within tech so much sometimes that we become numb to it.  It&apos;s time to do my very small part in this movement and purge this language from my active repos starting with this blog right here.\n    </p>\n    <p class=\"url\">\n    <span class=\"read-more\">read more</span>  waylonwalker.com\n    </p>\n</div>\n</a>\n<blockquote>\n<p>I used the technique from this post to switch master to main on my blog.</p>\n</blockquote>\n<h2>git reset</h2>\n<p><em>How I do Mass Undo</em></p>\n<p><strong>be careful</strong> work from a branch, make sure you started clean</p>\n<p>Let's say I wanted to change every occurrence of one variable name to another.\nLets try to replace replace <code class=\"language-text\">pandas.CSVDataSet</code> with <code class=\"language-text\">pandas.ParquetDataSet</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">grepr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>grep -iRl <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s|<span class=\"token variable\">$1</span>|<span class=\"token variable\">$2</span>|g\"</span><span class=\"token punctuation\">}</span>\n\n\ngrepr <span class=\"token string\">\"pandas.CSVDataSet\"</span> <span class=\"token string\">\"pandas.ParquetDataSet\"</span></code></pre></div>\n<p>Upon inspection of the <code class=\"language-text\">git diff</code> we notice that there was an unintentional change to the <code class=\"language-text\">docs/standard-storage.md</code> file. To revert the entire change we can run.</p>\n<p><strong>note</strong> These resets are irreversible.  Make sure that you started with a clean <code class=\"language-text\">git status</code> and you are confident that you didn't have any work on your machine, not in the remote repo.</p>\n<p><em><small><mark>match the remote and wipe out any changes</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> reset --hard origin/main</code></pre></div>\n<p><em><small><mark>match our last commit</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> reset --hard HEAD</code></pre></div>\n<h2>agr</h2>\n<p>I have an alternative version that I occasionally use as well that utilizes the silver searcher <code class=\"language-text\">ag</code>.  It does a great job at following your .gitignore rules with no fuss, and can filter down to file extensions simply with flags like <code class=\"language-text\">--md</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function-name function\">agr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>ag -l <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s/<span class=\"token variable\">$1</span>/<span class=\"token variable\">$2</span>/g\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h2>git clean</h2>\n<p><em>how I remove untracked files</em></p>\n<p>Sometimes our refactoring requires moving files around. If we want to undo steps like this git will not clean up untracked files.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mv</span> conf/base/sales-catalog.yml conf/base/sales/catalg.yml</code></pre></div>\n<p><em><small><mark>clean up untracked files</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clean -f</code></pre></div>\n<p><em><small><mark>clean up untracked directories</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clean -d</code></pre></div>\n<p><em><small><mark>clean up ignored files</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clean -x</code></pre></div>\n<p><code class=\"language-text\">-x</code> can be a bit dangerous, be careful with it.  You can lose significant time by wiping out a <code class=\"language-text\">node_modules</code>, <code class=\"language-text\">venv</code>, or credentials.</p>\n<h2>git  checkout</h2>\n<p><em>How I undo single files</em></p>\n<p>If our command was mostly successful, but just a few extra files were touched I will manually revert them with <code class=\"language-text\">git checkout &lt;filename&gt;</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> checkout conf/base/supply-catalog.yml</code></pre></div>\n<h2>git checkout --</h2>\n<p><em>How I undo an entire directory</em></p>\n<p>Sometimes we need to undo an entire directory.  This command will undo changes\nto all of the tracked files in the repo.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> checkout -- /src/pages/blog</code></pre></div>\n<h2>gitui</h2>\n<p>I really love using <code class=\"language-text\">gitui</code> as a handy terminal interface to browse logs, diffs, and commit a few files at a time.  It starts up crazy fast and is very intuitive to navigate through diffs of changes like this one file at a time if the <code class=\"language-text\">git diff</code> gets too overwhelming.</p>\n<p><a href=\"https://github.com/extrawurst/gitui\">https://github.com/extrawurst/gitui</a></p>","fields":{"slug":"/refactor-in-cli/"},"frontmatter":{"date":"2020-12-30T00:00:00.000Z","title":"Large Refactor At The Command Line","description":"As projects grow patterns that worked early on break and we need to change things to make the project easier to work wit","status":"published","cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/refactor-in-cli-xmas2020.png","xsm_img":{"fixed":{"src":"/static/caee54c45632d974fe802bdbb34f8b54/ef958/refactor-in-cli-xmas2020.png","srcWebp":"/static/caee54c45632d974fe802bdbb34f8b54/f6b6d/refactor-in-cli-xmas2020.webp"}},"sm_img":{"fixed":{"src":"/static/caee54c45632d974fe802bdbb34f8b54/630fb/refactor-in-cli-xmas2020.png","srcWebp":"/static/caee54c45632d974fe802bdbb34f8b54/403a4/refactor-in-cli-xmas2020.webp"}},"med_img":{"fixed":{"src":"/static/caee54c45632d974fe802bdbb34f8b54/46604/refactor-in-cli-xmas2020.png","srcWebp":"/static/caee54c45632d974fe802bdbb34f8b54/e9589/refactor-in-cli-xmas2020.webp"}},"full":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABh0lEQVQY021Q0WrbQBD0e18KwbYsudZJZ0eWdLd7F8mydFZsNxjXpE1pG9LUFNI6FFpsU/pQkg8oecgP5E/yf10p9K0wDMPC7M5Oo9vXhA7XXa6cvupybXNi7HC0fcUGyTAuAeYAx4ATqUuFBrRBnaPOGnblVIQnYZGoue1Brz8KwumLQRKJqcSZBOJS0gpVCDUGVZvt6qZuMbD8JyFbrqTLbpDF6qXDNeA8jCdRbAQYicS5VHllpszPXWFW55vvv6avPqw326tvP88uvrz9+PXdp8379fXizeWP7c12d7vb31yur3f736vT81CkqMeNA18LJ5xG6WEy86PxACeHquSycMMRi7LeMGVhlmTLwpwWZpXlCzNZJtlM4BjIzIbq8f7P3dX+mRNaHjSZbLqCktPPLQ/a9cThR5EoI2FiWUQip9ioiyo2ID7cfn5tzg56wq6bq+CjVYNE1aKPLEg1zvOjk3m6PE4XZXLCh2mj6UGHxR1PWv8M/0XbQ1rtB6N+mLEgoTpp8hdKLlvqrd3YVQAAAABJRU5ErkJggg==","width":1000,"height":420,"src":"/static/caee54c45632d974fe802bdbb34f8b54/a8734/refactor-in-cli-xmas2020.png","srcSet":"/static/caee54c45632d974fe802bdbb34f8b54/a8734/refactor-in-cli-xmas2020.png 1x"},"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABh0lEQVQY021Q0WrbQBD0e18KwbYsudZJZ0eWdLd7F8mydFZsNxjXpE1pG9LUFNI6FFpsU/pQkg8oecgP5E/yf10p9K0wDMPC7M5Oo9vXhA7XXa6cvupybXNi7HC0fcUGyTAuAeYAx4ATqUuFBrRBnaPOGnblVIQnYZGoue1Brz8KwumLQRKJqcSZBOJS0gpVCDUGVZvt6qZuMbD8JyFbrqTLbpDF6qXDNeA8jCdRbAQYicS5VHllpszPXWFW55vvv6avPqw326tvP88uvrz9+PXdp8379fXizeWP7c12d7vb31yur3f736vT81CkqMeNA18LJ5xG6WEy86PxACeHquSycMMRi7LeMGVhlmTLwpwWZpXlCzNZJtlM4BjIzIbq8f7P3dX+mRNaHjSZbLqCktPPLQ/a9cThR5EoI2FiWUQip9ioiyo2ID7cfn5tzg56wq6bq+CjVYNE1aKPLEg1zvOjk3m6PE4XZXLCh2mj6UGHxR1PWv8M/0XbQ1rtB6N+mLEgoTpp8hdKLlvqrd3YVQAAAABJRU5ErkJggg==","aspectRatio":2.380952380952381,"src":"/static/caee54c45632d974fe802bdbb34f8b54/a8734/refactor-in-cli-xmas2020.png","srcSet":"/static/caee54c45632d974fe802bdbb34f8b54/2d6f8/refactor-in-cli-xmas2020.png 250w,\n/static/caee54c45632d974fe802bdbb34f8b54/03ac3/refactor-in-cli-xmas2020.png 500w,\n/static/caee54c45632d974fe802bdbb34f8b54/a8734/refactor-in-cli-xmas2020.png 1000w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"eaf5184f-bfba-58a7-a09c-1a2ffcbb6ddc","prev":{"id":"a5a1d122-ce80-553f-bf7b-698c07059d12","html":"<ul>\n<li>\n<p>simple landing page</p>\n<ul>\n<li><a href=\"https://swyx.io\">https://swyx.io</a></li>\n<li>\n<p><a href=\"https://www.joelonsoftware.com/\">joel on software</a></p>\n<ul>\n<li>recent</li>\n<li>reading lists</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>More from waylon just above footer</p>\n<ul>\n<li>4x2 grid</li>\n</ul>\n</li>\n<li>\n<p>link strategy</p>\n<ul>\n<li>latest post</li>\n<li>next/prev</li>\n<li>similar tags</li>\n</ul>\n</li>\n<li>search in nav</li>\n<li>tag stickers</li>\n<li>simple cards?</li>\n<li>bookmarks?</li>\n<li>nav style stinks</li>\n<li>single post template</li>\n<li>flat routes no need to /blog /notes</li>\n<li>\n<p>post types</p>\n<ul>\n<li>🌳  full</li>\n<li>🌱  budding</li>\n<li>🖊  Note</li>\n<li>💻  hot tip</li>\n</ul>\n</li>\n<li>usage of tags</li>\n<li>\n<p>MDX</p>\n<ul>\n<li>stories</li>\n<li>slides</li>\n<li>⚠</li>\n<li>❌</li>\n<li>✔</li>\n<li>kedro viz</li>\n<li>charts</li>\n<li>inlink component</li>\n<li><a href=\"https://joshwcomeau.com/\" title=\"https://joshwcomeau.com/\">https://joshwcomeau.com/</a></li>\n<li>auto-card oneline links</li>\n</ul>\n</li>\n<li>\n<p>meta posts</p>\n<ul>\n<li>about</li>\n<li>uses</li>\n<li>how site is built</li>\n<li>how to search</li>\n</ul>\n</li>\n<li>stories</li>\n</ul>\n<h2>TODO</h2>\n<ul>\n<li>review package.json</li>\n<li>update package.json</li>\n</ul>\n<h2>Done</h2>\n<ul>\n<li>\n<p>ahrefs</p>\n<ul>\n<li>fix canonical urls</li>\n<li>fix broken inlinks</li>\n</ul>\n</li>\n<li>convert to one post template</li>\n<li>*</li>\n</ul>","fields":{"slug":"/rebrand/"},"frontmatter":{"tags":["blog"],"title":"rebrand","description":"A few notes for my next refactoring of waylonwalker.com","templateKey":"blog-post","status":"draft","date":"2020-11-14T06:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVQY02OQUTEEIkllQxllA2kVAxllQyllQzmQiL6kkr68qrGGtrWenoOenq2+vrWugY2hgZW+kbW+gYW+oRmDFEidAZCUUTOGkBJK+kKyWuKKegoa5tq6TnJqprr6DnoGDgaG9nr6Npo65lo6ZrqGFnoGQM1AC5UNJBT1eCVUReV1+STUZNWMrZz9gCaKyupIyhuKy+upqFqoa1oqqxjr6Fo5OPnY2nto6ZrqGZozAHWKKBko6NtExGfoWbi4+ITZuPivWb9FQErdwSPY1S/c0tEnMjLdyzsyK6tUXFK9ta23ubVLTlHT0NiSQVTVWEFArjm7cNu+Q5Onz339+m1GXvnN23fbuidt2rard9KMA4ePnzt/+dixU/v2H+7snHj9xq2Gpg55JS2QZiUtoxU15eeWrgtOyIqIy7hz90FdS/e5C5c3b9s9b9FyVT1rIOP6jdsHDhxtaurevefAnbv3W9t7oJr19fWnlEaFu4ar6NuIK+jauQVqGtm5+UUa27jrmTnLqBqp6llZu/jbOPvbWHk5WntnxuWG+kZb6NupaJgyiCrqSSpoi8tri8jrAgNJUFpTVF5HQEpDWFZLRF4HGPJiCrpCMppCMlrAmFNQM5ZV1pdV0QcGs7iiPgDeOIpWjusW8wAAAABJRU5ErkJggg==","width":500,"height":210,"src":"/static/39a1acbde1bb8f7103985f6a1f9fe0a7/46604/rebrand-xmas2020.png","srcSet":"/static/39a1acbde1bb8f7103985f6a1f9fe0a7/46604/rebrand-xmas2020.png 1x,\n/static/39a1acbde1bb8f7103985f6a1f9fe0a7/d8815/rebrand-xmas2020.png 1.5x,\n/static/39a1acbde1bb8f7103985f6a1f9fe0a7/31987/rebrand-xmas2020.png 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGElEQVQoz2OQUzWSUzWQUjOUVTGUUzOQVTGSVjGQUTaQU9GTVDWQVzbU0LYy0HPU1bc30LU1NLDWNbI11rPSN7I0MLBkkFYxBKqWVDGUUjYAMqSVDaRUDIBsKWV9CWV9SSV9OVVjTW0bXT17PT1bPX1rXQMbA30rPUMrPQMLBikVQ0llAxCCM5QNhGW1RRV0xZX0NLTs1DVtZVWN9fQcdPTsdPVtdfVttHQttHTMdEGaYRqEZLTEFfVE5HWEZbUMrdxU9KzEFHQl5Q3lVEwlFPS1tGw1tazU1M109Kwtrd2sbd209czAmlWNJFSNHDyC1QxsjKzcJJT05y9Z5RsazyYo7+QdqqRrYePk7+QcbGvvGx6RIiahlptXNnvuQjlFLQagNiF+2RDPoMvXbza09t6996ChtWfh0lWbt+2KSMi8fPVGTVPXydPnNm3eeeDgsRMnziSn5O7ff3jhouVgzSqG/cnpx/qmNvZMcfeL+Pnr17xFyzdv3XXxyrW9B440dfS7+0d++PDx9JkLx4+fmTpt7pmzFx4+erx42UppBQ0GMyODPTNLO7Pr3f2ihWQ180pqw2LTkzILy2tb/cMSPAKigAGRmlOaW1ydW1AVEZqcHJs9sWNKQ0WLuY41g4yKnq2poZKiDq+kuqSyPqeIEq+4qqC0BreYMp+EmoC0BjAIuESVecRVgFwZRQMVVWN1NRMNTTMNbXMA7RqdJZ9UjAEAAAAASUVORK5CYII=","width":200,"height":85,"src":"/static/39a1acbde1bb8f7103985f6a1f9fe0a7/71e30/rebrand-xmas2020.png","srcSet":"/static/39a1acbde1bb8f7103985f6a1f9fe0a7/71e30/rebrand-xmas2020.png 1x,\n/static/39a1acbde1bb8f7103985f6a1f9fe0a7/24123/rebrand-xmas2020.png 1.5x,\n/static/39a1acbde1bb8f7103985f6a1f9fe0a7/492a0/rebrand-xmas2020.png 2x"}}}}},"next":{"id":"47d93c93-3167-55af-898b-60f0a96abdda","html":"<p>Today we ran into an issue where we had a one-off script that just needed to work, but it was just chewing threw memory like nothing.</p>\n<h2>Pre check the status of memory.</h2>\n<p>There are a number of ways that you can check the amount of memory on your system.  The easiest is not necessarily my first go to is free... literally <code class=\"language-text\">free</code>.</p>\n<p><em><small><mark>check for free space</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">free</span> -h\n             total       used       <span class=\"token function\">free</span>     shared    buffers     cached\nMem:           15G        15G       150M         0B        59M       <span class=\"token number\">8</span>.7G</code></pre></div>\n<p>Generally my first go to is a bit more graphical, and not available on a stock stystem, but far more useful.... <code class=\"language-text\">htop</code>.  <a href=\"https://htop.dev\"><code class=\"language-text\">htop</code></a> is a terminal process explorer that shows cpu usage, mem usage, and running processes.</p>\n<p><em><small><mark>htop</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token function\">htop</span> <span class=\"token comment\"># install it from your package repo</span>\n<span class=\"token function\">htop</span></code></pre></div>\n<p><img src=\"https://waylonwalker.com/htop-2.0.png\" alt=\"htop in use\"></p>\n<h2>First step throw more swap at it</h2>\n<p>Often before going through the process of getting a larger instance underneath the notebook you can hobble home with a bit more swap file.  It may not be pretty or fast, but gets the job done in a pinch.</p>\n<p><em><small><mark>Check for free disk</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">du</span>\n\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/asdasd        200G   50G  150G   <span class=\"token number\">25</span>% /</code></pre></div>\n<blockquote>\n<p>Make sure you check your free disk space first, filling both memory and disk can be bad news</p>\n</blockquote>\n<p><em><small><mark>make a swap file and activate it</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">SWAPFILE</span><span class=\"token operator\">=</span>~/swaps/swap1-50G\n<span class=\"token function\">mkdir</span> ~/swaps\n<span class=\"token function\">sudo</span> fallocate -l 50G <span class=\"token variable\">$SWAPFILE</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> <span class=\"token number\">600</span> <span class=\"token variable\">$SWAPFILE</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mkswap</span> <span class=\"token variable\">$SWAPFILE</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">swapon</span> <span class=\"token variable\">$SWAPFILE</span></code></pre></div>\n<p>You can see the results with either swapon or free.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">swapon</span> --show\n<span class=\"token function\">free</span> -h</code></pre></div>\n<p style=\"text-align: center\">\n<a href=\"https://linuxize.com/post/how-to-add-swap-space-on-ubuntu-20-04/\">\n  <img style=\"width:500px; max-width:80%; margin: auto;\" src=\"https://waylonwalker.com/linuxize-how-to-add-swap-space-on-ubuntu-20-04.jpg\" alt=\"How to Add Swap Space on Ubuntu 20.04\">\n  </a>\n</p>\n<p><a href=\"https://linuxize.com/post/how-to-add-swap-space-on-ubuntu-20-04/\">linuxize how to add swap space on ubuntu 20.04</a></p>\n<p>More details on creating swapfiles checkout <a href=\"https://linuxize.com/post/how-to-add-swap-space-on-ubuntu-20-04/\">linuxize</a>.  It is my favorite linux tutorial site!</p>\n<h2>Refactor - functions</h2>\n<p><em>keep big datasets inside functions returning aggregations</em></p>\n<p>Sometimes there is a clear quick and simple way to just let the python garbage collector.  Often we pull in large datasets to create features then aggregate them down into smaller datasets that can be then joined into other datasets.  This pattern of pulling in  <code class=\"language-text\">big_data</code>, processing then aggregating can be a simple one.</p>\n<p><em><small><mark>let the garbage collector take care of big data</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   big_data <span class=\"token operator\">=</span> get_big_data<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n   smaller_data <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>some aggregation<span class=\"token operator\">></span>\n   <span class=\"token keyword\">return</span> smaller_data\ndata <span class=\"token operator\">=</span> process<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>If your notebook is following this type of pattern a simple <code class=\"language-text\">del</code> won't work because ipython adds extra references to your <code class=\"language-text\">big_data</code> that you didnt add.  These are things that enable features like <code class=\"language-text\">_</code>, <code class=\"language-text\">__</code>, <code class=\"language-text\">___</code>, umong others.</p>\n<h2>%reset</h2>\n<p><em>check out more on reset from the <a href=\"https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-reset\">ipython docs</a></em></p>\n<p>The last resort I would lean on here is an <code class=\"language-text\">ipython</code> specific feature <code class=\"language-text\">%reset</code> and <code class=\"language-text\">%reset_selective</code>.  These will flush out all user define variables or selecive ones based on a regex respectively.</p>\n<p>Following two example are directly from the <a href=\"https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-reset\">ipython docs</a></p>\n<p><em><small><mark>%reset</mark></small></em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">In <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\nIn <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> a\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n\nIn <span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span> <span class=\"token keyword\">in</span> get_ipython<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>user_ns\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span>\n\nIn <span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">%</span>reset <span class=\"token operator\">-</span>f\n\nIn <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'a'</span> <span class=\"token keyword\">in</span> get_ipython<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>user_ns\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span>\n\nIn <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">%</span>reset <span class=\"token operator\">-</span>f <span class=\"token keyword\">in</span>\nFlushing <span class=\"token builtin\">input</span> history\n\nIn <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">%</span>reset <span class=\"token operator\">-</span>f dhist <span class=\"token keyword\">in</span>\nFlushing directory history\nFlushing <span class=\"token builtin\">input</span> history</code></pre></div>\n<p><em><small><mark>%reset</em>selective</mark></small>_</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">In [2]: a=1; b=2; c=3; b1m=4; b2m=5; b3m=6; b4m=7; b2s=8\n\nIn [3]: who_ls\nOut[3]: [&#39;a&#39;, &#39;b&#39;, &#39;b1m&#39;, &#39;b2m&#39;, &#39;b2s&#39;, &#39;b3m&#39;, &#39;b4m&#39;, &#39;c&#39;]\n\nIn [4]: %reset_selective -f b[2-3]m\n\nIn [5]: who_ls\nOut[5]: [&#39;a&#39;, &#39;b&#39;, &#39;b1m&#39;, &#39;b2s&#39;, &#39;b4m&#39;, &#39;c&#39;]\n\nIn [6]: %reset_selective -f d\n\nIn [7]: who_ls\nOut[7]: [&#39;a&#39;, &#39;b&#39;, &#39;b1m&#39;, &#39;b2s&#39;, &#39;b4m&#39;, &#39;c&#39;]\n\nIn [8]: %reset_selective -f c\n\nIn [9]: who_ls\nOut[9]: [&#39;a&#39;, &#39;b&#39;, &#39;b1m&#39;, &#39;b2s&#39;, &#39;b4m&#39;]\n\nIn [10]: %reset_selective -f b\n\nIn [11]: who_ls\nOut[11]: [&#39;a&#39;]</code></pre></div>\n<h2>Develop faster utilizing autoreload in ipython</h2>\n<p>The above tips will help you reclaim used memory in ipython, but the following tip is one that single handedly is the reason I use Ipython for faster development over anything else.</p>\n<p style=\"text-align: center\">\n<a href=\"https://waylonwalker.com/autoreload-ipython\">\n  <img style=\"width:500px; max-width:80%; margin: auto;\" src=\"https://waylonwalker.com/autoreload-ipython-rm.png\" alt=\"Autoreload in Ipython\">\n  </a>\n</p>\n<p><a href=\"https://waylonwalker.com/autoreload-ipython\">autoreload-ipython</a> one of my biggest productivity boosts.</p>","fields":{"slug":"/reset-ipython/"},"frontmatter":{"tags":["python"],"title":"Reclaim memory usage in Jupyter","description":"Today we ran into an issue where we had a one-off script that just needed to work, but it was just chewing threw memory like nothing.","templateKey":"blog-post","status":"published","date":"2020-10-01T05:00:00.000Z","cover":{"med_img":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABwUlEQVQY01XQS2sTURQH8GxdlWpT02Qmj3knuXPPuTOZZO5kpiNTOqg1xZRAqy004gOx8YEKkeLC0kXcuHCRtqBgN+5cKKZCwID4DQTx8zgpBRH+u8PvfzgnJaqWKFOVNe93b93odPLF8oIEBQVzGiSjcsVDtgRwCWER0adWYAMHy2PMRdZICQrLyVAivHezfWct9mpOwXBEhQkaE1RL0h2D+IxFCCFiYKKPwCnzgLnA6qmswhaSyHhR1Oru4ujrKIzXzs1JM1l9XqSS6uVkS1LqquEaFU7BJ+CZwAk2KJ7irIy5aYWVLsHgzfDt8F2wfP1p/1X33pNHj18Oj44f7PR3ei/WN25rhkOxaSI30T3FMs6rVlqxMiWqUO/98cfx5Mev33++jSe7e4NPn0dfTsbfJz8PDj+stDb0cv0/fF5CU6w0JHIh+ZNR41FLIry93o1bm9c623d7zwXNDqO2y68Qs2lCEu8fLhp48np/sP1wJk+S5XP5alosZzHmV1c1nUQ2iArNFKFKAgqBSc8wMD7FFOCgv7XCW7NidXq8ymYF83JndffZsqxj3LALGmYkLOoOg9C1otCOg9qSb0eyXvsLGqN0+9wexDIAAAAASUVORK5CYII=","width":500,"height":210,"src":"/static/e3dd2cdcea2b29c226faa05bcaf301a4/46604/reset-ipython-xmas2020.png","srcSet":"/static/e3dd2cdcea2b29c226faa05bcaf301a4/46604/reset-ipython-xmas2020.png 1x,\n/static/e3dd2cdcea2b29c226faa05bcaf301a4/d8815/reset-ipython-xmas2020.png 1.5x,\n/static/e3dd2cdcea2b29c226faa05bcaf301a4/31987/reset-ipython-xmas2020.png 2x"}},"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+UlEQVQoz0WPy2sTURTGsxMECRFNJsnM5DF3MpnHvefemTzmkcmrUUFjFZtKbRNUorXVErALER+LCoKRFmI3KorUnRshiLiQbnTnA4ugiP+Nk1YUPs7inPM75/tComwKEsmAu9jtDvo9RTYOC3leYiIi8RxNSUw1PAYNDDWKfUY9bPoWccF0KHVCvGwmESRV+3KnvTp3rGYSpFkJxAREEzLjERNlS9V9oA0IeOpjWqHgEuYQaoeCvUBcFmIpLY2M8Xi8dn9938F0OKHsj0q8aKGcy2VAkspZVFTyZUIrBrgYHGMCSzQu0UlFZkQwOr2lN+/ee63p+YtXrwxuzHWX79wdro8eLywsr6zcnOlcUNQSCcyDg/dgTjZjshmcCP7fXnvw+evOpy/ffv76vbH59Mnzl6/Hb3e+/9je/ri19ao5dVoznP9wVKJJTka8wiEWTeOTs+ftRvvMfP/hxgjKU/eGj6bPXXLq7ZnZfutoR9UcAhW8a5vswvBscH2ztxhO4YQEkWT+kKgf4JS4dUrQylXHcyiEeVXMWprmYRIE9nRi62BrUAoVTfjw4tbq2WuRhP43fMaIqrXhaOnE8YKmQLVgcpM+U3TXog2bNX3riGc168VWiEekUqA5BNEMBJn3FMtAvYqFHMGkSDTybyTlSxhXGPiYuIpW/gPzr4KPTbkJNAAAAABJRU5ErkJggg==","width":200,"height":85,"src":"/static/e3dd2cdcea2b29c226faa05bcaf301a4/71e30/reset-ipython-xmas2020.png","srcSet":"/static/e3dd2cdcea2b29c226faa05bcaf301a4/71e30/reset-ipython-xmas2020.png 1x,\n/static/e3dd2cdcea2b29c226faa05bcaf301a4/24123/reset-ipython-xmas2020.png 1.5x,\n/static/e3dd2cdcea2b29c226faa05bcaf301a4/492a0/reset-ipython-xmas2020.png 2x"}}}}},"similarPosts":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]}},"staticQueryHashes":["2992646504"]}
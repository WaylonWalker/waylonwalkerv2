{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/supercharge-zsh-startup/","result":{"data":{"markdownRemark":{"id":"6743d6ee-d9d3-508a-b6b9-ccc748510e46","html":"<blockquote>\n<p>Photo by <a href=\"https://unsplash.com/@maxlarochelle?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Max LaRochelle</a> on <a href=\"https://unsplash.com/s/photos/lightning?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Unsplash</a></p>\n</blockquote>\n<p>I have been using oh-my-zsh successfully for about 2 years now. But lately my startup time has been really bothersome. It has grown to the point where it was taking about <strong>5.5s</strong> to startup a shell!  This is ok if I am going to spend some time in here for awhile and do some work that benefits from all of the autocompletions, plugins, and shortcuts that oh-my-zsh brings.  But to only jump in to run a handful of commands is infuriating.</p>\n<h3>üìë My Setup</h3>\n<p>I believe the real issue is io speed on wsl.  I have some remote servers with similar configs that are 10x faster or more, loading in 100s of milliseconds rather than seconds.  Sourcing all of the individual plugin files are just too much for it.</p>\n<h2>üí® How Fast can it be</h2>\n<blockquote>\n<p>Quick side note: your zsh config is controled by your ~/.zshrc file.  This file can source other files, load plugins, or run literally anything.</p>\n</blockquote>\n<p>Time the <strong>initial</strong> time</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">time</span> <span class=\"token function\">zsh</span> -c <span class=\"token builtin class-name\">exit</span></code></pre></div>\n<p>Move your <strong>~/.zshrc</strong> config file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mv</span> ~/.zshrc ~/.zshrc-back</code></pre></div>\n<p>Time the fastest startup possible with nothing in your <strong>~/.zshrc</strong> config file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">time</span> <span class=\"token function\">zsh</span> -c <span class=\"token builtin class-name\">exit</span></code></pre></div>\n<p>Move your <strong>~/.zshrc</strong> back</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mv</span> ~/.zshrc-back ~/.zshrc</code></pre></div>\n<h2>üïµÔ∏è‚Äç‚ôÇÔ∏èProfile your startup time</h2>\n<p>It is possible to profile your zsh startup time by adding <code class=\"language-text\">zmodload zsh/zprof</code> to the start of your <code class=\"language-text\">~/.zshrc</code> file and <code class=\"language-text\">zprof</code> at the end.  This was unsuccessfull for me.  I ended up just backing up <code class=\"language-text\">~/.zshrc</code> file, then deleting half of it to see where the hot spots were.  I found that two places that were really hot for me.  One I was inadvertantly setting git and npm settings everytime that didnt need to be set everytime.  That was an easy 2s gain.  Another easy 3s gain was removing oh-my-zsh.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># ~/.zshrc</span>\nzmodload zsh/zprof\n<span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">..</span>\n<span class=\"token builtin class-name\">.</span>\nzprof</code></pre></div>\n<h2>üò≠But I really like oh-my-zsh</h2>\n<p>without all the bells and whistle that oh-my-zsh provided zsh became lightning fast to load, but incredibly boring.  It was also very painful to manually type out everything that it autocompleted or aliased all the time.  Next I headed down a path to get all of that functionality back without sacrificing load time.</p>\n<blockquote>\n<p>Without oh-my-zsh, zsh became incredibly boring.</p>\n</blockquote>\n<h2>üîå Plugin Managers</h2>\n<p><img src=\"../../../static/steve-johnson-ZUabNmumOcA-unsplash.jpg\"></p>\n<blockquote>\n<p>Photo by <a href=\"https://unsplash.com/@steve_j?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Steve Johnson</a> on <a href=\"https://unsplash.com/s/photos/plug?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Unsplash</a></p>\n</blockquote>\n<ul>\n<li>oh-my-zsh</li>\n<li>zplugin</li>\n<li>zgen</li>\n</ul>\n<p>There are a number of plugin managers for zsh, I tried each of the ones listed above, but found that as I approached a nice setup that I liked the load time would creep up <strong>above the 2s</strong> <strong>mark</strong> each time. I would turn certain plugins on and off, try different plugin managers, before realizing that I had spent enough time on this problem and it was going to be time to settle on fast startup or functionality.</p>\n<h2>‚öñ Finding Balance</h2>\n<p><em>Semi-lazy loading</em></p>\n<p><img src=\"../../../static/jeppe-hove-jensen-b3eaH1hguOA-unsplash.jpg\"></p>\n<blockquote>\n<p>Photo by <a href=\"https://unsplash.com/@haywire?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Jeppe Hove</a> Jensen on <a href=\"https://unsplash.com/s/photos/balance?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Unsplash</a></p>\n</blockquote>\n<p>After struggling to get all of the features I wanted with a fast load time, I decided to only load what I needed upon startup.  Next I created a simple alias that loads in zgen and all of the plugins I want. By doing this I get two main benefits.  Obviously I get a faster starup time by loading less.  I got my startup time down to about 0.25s.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># ~/.zshrc</span>\n<span class=\"token function-name function\">p</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nzgen load zsh-users/zsh-autosuggestions\n<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>\n<span class=\"token punctuation\">..</span>\n<span class=\"token builtin class-name\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>‚ö° Fast Loading</h3>\n<p>I really like the fast startup time, because sometimes I am only loading up zsh to run a handful of commands that dont need much in the way of plugins</p>\n<p><strong>simple commands that need üí® blazing start speed</strong></p>\n<p><em>any single easy to type command, these are my common commands that I will open a terminal in my editor and just need to run quick.</em></p>\n<ul>\n<li>vim</li>\n<li>git add . &#x26;&#x26; git commit &#x26;&#x26; git push</li>\n<li>sh my_script.sh</li>\n<li>make build</li>\n<li>bake build</li>\n<li>pytest</li>\n<li>gatsby develop</li>\n<li>npm i</li>\n<li>npm update</li>\n<li>pip install</li>\n<li>ipython</li>\n</ul>\n<p>The second benefit was that I can continue typing while plugins are loading.</p>\n<p><img src=\"../../../static/type-while-loading-plugins.gif\"></p>\n<h2>>Prompt</h2>\n<p>After removing oh-my-zsh the first thing that I missed was the themes that it provided.  I went through a number of them and the one that seemed to have the smallest effect on performance and everything I needed was <a href=\"https://starship.rs/\">starship</a>.  It's a really fast prompt written in rust.  The biggest thing that I needed to have that other prompts were misssing was conda environments.  I live much of my work life running python from various conda environments and it is crutial that I can see what environment I am in at all times.</p>\n<p><img src=\"../../../static/2020-01-04%2012-36-31_Cortana.png\"></p>\n<h2>üí∞ Bonus</h2>\n<p>I applied the same logic to neovim and achieved similar results.  Again it just had too many plugins loading on startup for simple tasks.  I ended up taking a shortcut and load any heavy plugins upon NerdTreeToggle.  I dont really use NERDTree that much, but when I do its for more than just a quick edit.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># ~/.config/nvim/init.vim</span>\n<span class=\"token punctuation\">..</span>.\nPlug <span class=\"token string\">'valloric/youcompleteme'</span>, <span class=\"token punctuation\">{</span><span class=\"token string\">'do'</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">'./install.py'</span>, <span class=\"token string\">'on'</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">'NERDTreeToggle'</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">..</span>.</code></pre></div>","frontmatter":{"date":"2020-01-03T06:00:00.000Z","devto_url":null,"devto_id":null,"title":"Supercharge Zsh Startup","description":"","path":"speed-up-cli-apps","twitter_cover":{"id":"c6340a00-d7b2-593b-8492-265d9b3baee5","absolutePath":"/mnt/c/personal/ww/waylonwalkerv2/static/max-larochelle-uu-Jw5SunYI-unsplash.jpg","childImageSharp":{"id":"2ddd0c92-26c4-5234-9f3b-8ba7cc583b71","fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMFAQT/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAABye21IsVYip4wVUln/8QAHRAAAgIBBQAAAAAAAAAAAAAAAQIAAwQQERITIP/aAAgBAQABBQLVRvOtVqMFzAHIYjn4/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERAhL/2gAIAQMBAT8BWKQ6ZT//xAAWEQADAAAAAAAAAAAAAAAAAAABEBL/2gAIAQIBAT8BoKQv/8QAGRAAAwADAAAAAAAAAAAAAAAAAREgECEx/9oACAEBAAY/Ao2C8Icr/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERITEgQZH/2gAIAQEAAT8hIQW2UzQjsrsTJoNEkIRzwbN1rh//2gAMAwEAAgADAAAAELg7Av/EABcRAQEBAQAAAAAAAAAAAAAAAAABEUH/2gAIAQMBAT8QoaSfW3//xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQYf/aAAgBAgEBPxCDjziQ/8QAGxABAQADAQEBAAAAAAAAAAAAAREAIVExIEH/2gAIAQEAAT8QC5R6TK5ggDdCFxsbNpMdmAMmDlNxBu/cmhI6X8c9xEKvPj//2Q==","width":800,"height":418,"src":"/static/d0a621bc07ad1f1082182e6dde1e5085/5d469/max-larochelle-uu-Jw5SunYI-unsplash.jpg","srcSet":"/static/d0a621bc07ad1f1082182e6dde1e5085/5d469/max-larochelle-uu-Jw5SunYI-unsplash.jpg 1x,\n/static/d0a621bc07ad1f1082182e6dde1e5085/3d47d/max-larochelle-uu-Jw5SunYI-unsplash.jpg 1.5x,\n/static/d0a621bc07ad1f1082182e6dde1e5085/0c99a/max-larochelle-uu-Jw5SunYI-unsplash.jpg 2x"}}},"cover":{"id":"c6340a00-d7b2-593b-8492-265d9b3baee5","absolutePath":"/mnt/c/personal/ww/waylonwalkerv2/static/max-larochelle-uu-Jw5SunYI-unsplash.jpg","childImageSharp":{"id":"2ddd0c92-26c4-5234-9f3b-8ba7cc583b71","fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMFAQT/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAABye21IsVYip4wVUln/8QAHRAAAgIBBQAAAAAAAAAAAAAAAQIAAwQQERITIP/aAAgBAQABBQLVRvOtVqMFzAHIYjn4/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERAhL/2gAIAQMBAT8BWKQ6ZT//xAAWEQADAAAAAAAAAAAAAAAAAAABEBL/2gAIAQIBAT8BoKQv/8QAGRAAAwADAAAAAAAAAAAAAAAAAREgECEx/9oACAEBAAY/Ao2C8Icr/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERITEgQZH/2gAIAQEAAT8hIQW2UzQjsrsTJoNEkIRzwbN1rh//2gAMAwEAAgADAAAAELg7Av/EABcRAQEBAQAAAAAAAAAAAAAAAAABEUH/2gAIAQMBAT8QoaSfW3//xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQYf/aAAgBAgEBPxCDjziQ/8QAGxABAQADAQEBAAAAAAAAAAAAAREAIVExIEH/2gAIAQEAAT8QC5R6TK5ggDdCFxsbNpMdmAMmDlNxBu/cmhI6X8c9xEKvPj//2Q==","width":1000,"height":420,"src":"/static/d0a621bc07ad1f1082182e6dde1e5085/9cf42/max-larochelle-uu-Jw5SunYI-unsplash.jpg","srcSet":"/static/d0a621bc07ad1f1082182e6dde1e5085/9cf42/max-larochelle-uu-Jw5SunYI-unsplash.jpg 1x,\n/static/d0a621bc07ad1f1082182e6dde1e5085/55395/max-larochelle-uu-Jw5SunYI-unsplash.jpg 1.5x,\n/static/d0a621bc07ad1f1082182e6dde1e5085/5858b/max-larochelle-uu-Jw5SunYI-unsplash.jpg 2x"},"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMFAQT/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAABye21IsVYip4wVUln/8QAHRAAAgIBBQAAAAAAAAAAAAAAAQIAAwQQERITIP/aAAgBAQABBQLVRvOtVqMFzAHIYjn4/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERAhL/2gAIAQMBAT8BWKQ6ZT//xAAWEQADAAAAAAAAAAAAAAAAAAABEBL/2gAIAQIBAT8BoKQv/8QAGRAAAwADAAAAAAAAAAAAAAAAAREgECEx/9oACAEBAAY/Ao2C8Icr/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERITEgQZH/2gAIAQEAAT8hIQW2UzQjsrsTJoNEkIRzwbN1rh//2gAMAwEAAgADAAAAELg7Av/EABcRAQEBAQAAAAAAAAAAAAAAAAABEUH/2gAIAQMBAT8QoaSfW3//xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQYf/aAAgBAgEBPxCDjziQ/8QAGxABAQADAQEBAAAAAAAAAAAAAREAIVExIEH/2gAIAQEAAT8QC5R6TK5ggDdCFxsbNpMdmAMmDlNxBu/cmhI6X8c9xEKvPj//2Q==","aspectRatio":2.380952380952381,"src":"/static/d0a621bc07ad1f1082182e6dde1e5085/9cf42/max-larochelle-uu-Jw5SunYI-unsplash.jpg","srcSet":"/static/d0a621bc07ad1f1082182e6dde1e5085/ff9d4/max-larochelle-uu-Jw5SunYI-unsplash.jpg 250w,\n/static/d0a621bc07ad1f1082182e6dde1e5085/2dc04/max-larochelle-uu-Jw5SunYI-unsplash.jpg 500w,\n/static/d0a621bc07ad1f1082182e6dde1e5085/9cf42/max-larochelle-uu-Jw5SunYI-unsplash.jpg 1000w,\n/static/d0a621bc07ad1f1082182e6dde1e5085/55395/max-larochelle-uu-Jw5SunYI-unsplash.jpg 1500w,\n/static/d0a621bc07ad1f1082182e6dde1e5085/5858b/max-larochelle-uu-Jw5SunYI-unsplash.jpg 2000w,\n/static/d0a621bc07ad1f1082182e6dde1e5085/481c1/max-larochelle-uu-Jw5SunYI-unsplash.jpg 2079w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"6743d6ee-d9d3-508a-b6b9-ccc748510e46"}}}
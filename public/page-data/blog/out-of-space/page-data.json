{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/out-of-space/","result":{"data":{"markdownRemark":{"id":"43158e7b-1063-574b-ba4f-02615822784e","html":"<p>This morning I logged into my machine and was nearly out of space</p>\n<ul>\n<li>64GB miniconda3!</li>\n<li>5GB conda cache</li>\n<li>4GM pip cache</li>\n<li>34GB docker</li>\n</ul>\n<h2>Find it</h2>\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--0LE2KZJW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/je7pxcagfs7m23p98kck.jpg\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--0LE2KZJW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/je7pxcagfs7m23p98kck.jpg\" alt=\"Looking for big files when the weeds are too tall\"></a></p>\n<blockquote>\n<p>Photo by <a href=\"https://unsplash.com/@simonmigaj?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Simon Migaj</a> on <a href=\"https://unsplash.com/s/photos/find?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Unsplash</a></p>\n</blockquote>\n<p>These are the commands that I often use to reclaim space.  Its so easy to fill up small vm's in the cloud, or in my case today let your dev machine go way too long without a good cleanup.</p>\n<h3>Show Remaining Space on Drives</h3>\n<p>This shows us where to start and gives a baseline of how much space we have reclaimed.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">df</span> -h</code></pre></div>\n<h3>show largest files in current directory</h3>\n<p>Next keep drilling into directories that are big and running this command to see whats big inside of it.  When you find somethign that you are willing to part with <code class=\"language-text\">rm -rf &lt;directory&gt;</code> it and check <code class=\"language-text\">df -h</code> to see if you have enough reclaimed yet.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">du</span> <span class=\"token builtin class-name\">.</span> -h --max-depth<span class=\"token operator\">=</span><span class=\"token number\">1</span></code></pre></div>\n<p>Honestly I rarely bother unless the directory is in the GB's of space.  A super simple filter for that is to just grep for G.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">du</span> <span class=\"token builtin class-name\">.</span> -h --max-depth<span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> G</code></pre></div>\n<h2>conda</h2>\n<h3>How Many?</h3>\n<p>As a first baseline lets see how many enviroments we are starting with. I started with 71. Yeah I have had this machine for 2 years, and dont regularly remove them.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">conda info --envs <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -n +2 <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> -l</code></pre></div>\n<p>bash</p>\n<h3>Lets batch it out!</h3>\n<p>We are devs here surely we can automate this issue! The following four lines will generate a list of existing conda environments, edit them with vim, remove the remaining ones, then remove the text file we created to remove from.</p>\n<p>Make sure that you only keep names of environments that you want to <strong>remove</strong> in <code class=\"language-text\">conda_envs_to_remove.txt</code> and delete the environment names you want to keep.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">conda info --envs <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -n +2 <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">' '</span> -f1 <span class=\"token operator\">></span> conda_envs_to_remove.txt\n<span class=\"token function\">vim</span> conda_envs_to_remove.txt\n<span class=\"token function\">cat</span> ~/.conda_envs_remove <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\n\">\\n</span>'</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\0\">\\0</span>'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -l -0 conda remove --all -y -n\n<span class=\"token function\">rm</span> conda_envs_to_remove.txt</code></pre></div>\n<h3>üìù Side note</h3>\n<p>When I am creating one of these complicated bash pipelines including xargs I generally print out the command first and make sure that it does what I want. The following command will test the above script before doing dangerous things!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> ~/.conda_envs_remove <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\n\">\\n</span>'</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\0\">\\0</span>'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -l -0 <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"conda remove --all -y -n \"</span></code></pre></div>\n<h2>Cache</h2>\n<p>If your feeling really strained for space, you can <code class=\"language-text\">rm -rf ~/.cache</code>. Personally I like the improved speed of installing everything... obviously I install a lot of new environments.</p>\n<h2>Docker</h2>\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--W4NWBxYC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/olcef3lh31dtrwa51u7g.jpg\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--W4NWBxYC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/olcef3lh31dtrwa51u7g.jpg\" alt=\"Alt Text\"></a></p>\n<blockquote>\n<p>Photo by <a href=\"https://unsplash.com/@henry_be?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Henry Be</a> on <a href=\"https://unsplash.com/s/photos/dark-fire?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Unsplash</a></p>\n</blockquote>\n<p>For more information read this article, <a href=\"https://docs.docker.com/config/pruning/\" title=\"https://docs.docker.com/config/pruning/\">https://docs.docker.com/config/pruning/</a>. I have all of the images that I want pushed remotely so I just dumped everything with the following command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker system prune</code></pre></div>\n<p>Running these two sets of commands cleared up about <strong>70GB</strong> of space for me with very little effort on my behalf. I hope others find the first command helpful to batch remove many conda environments at once.</p>","frontmatter":{"date":"2020-02-01T06:00:00.000Z","title":"Out of Space","description":"Out of Space! How to remove 65 conda environments in one command.","path":"out-of-space","twitter_cover":{"id":"7e627fb7-341f-59f9-aea5-e9707743bdae","absolutePath":"/mnt/c/personal/ww/waylonwalkerv2/static/photo-1464802686167-b939a6910659.jpg","childImageSharp":{"id":"e9a35a4a-66a1-56d2-b913-75d09077393c","fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUBAgME/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwAB/9oADAMBAAIQAxAAAAFVtboY1pJl/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAIBAyETMf/aAAgBAQABBQKK5OWSpWxZ4z7/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwFsf//EABYQAQEBAAAAAAAAAAAAAAAAAAEQIP/aAAgBAQAGPwLAz//EABkQAQEBAQEBAAAAAAAAAAAAAAEAESExQf/aAAgBAQABPyHIJ9n0utgHJATe2+wv/9oADAMBAAIAAwAAABCg/wD/xAAWEQADAAAAAAAAAAAAAAAAAAAAESH/2gAIAQMBAT8QbpT/xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8Q0If/xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVHh/9oACAEBAAE/EFvWcl7nsXShfZQx6Q3GpTUtafYjUCf/2Q==","width":800,"height":418,"src":"/static/36fe12597f6a84095e35d4fb35af7312/5d469/photo-1464802686167-b939a6910659.jpg","srcSet":"/static/36fe12597f6a84095e35d4fb35af7312/5d469/photo-1464802686167-b939a6910659.jpg 1x,\n/static/36fe12597f6a84095e35d4fb35af7312/3d47d/photo-1464802686167-b939a6910659.jpg 1.5x"}}},"cover":{"id":"7e627fb7-341f-59f9-aea5-e9707743bdae","absolutePath":"/mnt/c/personal/ww/waylonwalkerv2/static/photo-1464802686167-b939a6910659.jpg","childImageSharp":{"id":"e9a35a4a-66a1-56d2-b913-75d09077393c","fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUBAgME/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwAB/9oADAMBAAIQAxAAAAFVtboY1pJl/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAIBAyETMf/aAAgBAQABBQKK5OWSpWxZ4z7/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwFsf//EABYQAQEBAAAAAAAAAAAAAAAAAAEQIP/aAAgBAQAGPwLAz//EABkQAQEBAQEBAAAAAAAAAAAAAAEAESExQf/aAAgBAQABPyHIJ9n0utgHJATe2+wv/9oADAMBAAIAAwAAABCg/wD/xAAWEQADAAAAAAAAAAAAAAAAAAAAESH/2gAIAQMBAT8QbpT/xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8Q0If/xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVHh/9oACAEBAAE/EFvWcl7nsXShfZQx6Q3GpTUtafYjUCf/2Q==","width":1000,"height":420,"src":"/static/36fe12597f6a84095e35d4fb35af7312/9cf42/photo-1464802686167-b939a6910659.jpg","srcSet":"/static/36fe12597f6a84095e35d4fb35af7312/9cf42/photo-1464802686167-b939a6910659.jpg 1x"},"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAf/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAf/aAAwDAQACEAMQAAABltY1jnGmX//EABkQAAIDAQAAAAAAAAAAAAAAAAACAQMhE//aAAgBAQABBQKK5OWSojFmDPv/xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPwFX/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/AWx//8QAFhABAQEAAAAAAAAAAAAAAAAAARAg/9oACAEBAAY/AsDP/8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERITFBUf/aAAgBAQABPyHF3R8hqTmDpEX2FHaR/9oADAMBAAIAAwAAABCg/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAARECH/2gAIAQMBAT8QXY//xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8Q0If/xAAbEAEBAQACAwAAAAAAAAAAAAABEQAhMUFRcf/aAAgBAQABPxAN2DYNn3T5Cp73JHxiMdt20KozyAd//9k=","aspectRatio":2.380952380952381,"src":"/static/36fe12597f6a84095e35d4fb35af7312/9cf42/photo-1464802686167-b939a6910659.jpg","srcSet":"/static/36fe12597f6a84095e35d4fb35af7312/ff9d4/photo-1464802686167-b939a6910659.jpg 250w,\n/static/36fe12597f6a84095e35d4fb35af7312/2dc04/photo-1464802686167-b939a6910659.jpg 500w,\n/static/36fe12597f6a84095e35d4fb35af7312/9cf42/photo-1464802686167-b939a6910659.jpg 1000w,\n/static/36fe12597f6a84095e35d4fb35af7312/10ebf/photo-1464802686167-b939a6910659.jpg 1333w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"43158e7b-1063-574b-ba4f-02615822784e"}}}
<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /> -->
  <meta content="width=device-width" name="viewport"/>
  <link href="/8bitcc_48x.png" rel="icon" type="image/png"/>
  <meta content="$ilp.uphold.com/MGN2ni2YMXaQ" name="monetization" property="monetization"/>
  <link href="/furo-purge.css" rel="stylesheet"/>
  <link href="/monokai.css" rel="stylesheet"/>
  <link href="/archive-styles.css" rel="stylesheet"/>
  <title>
   Kedro
  </title>
  <meta content="article" name="og:type" property="og:type"/>
  <meta content="Waylon Walker" name="og:author" property="og:author"/>
  <meta content="Waylon Walker" name="og:site_name" property="og:site_name"/>
  <meta content="My Notes about using kedro" name="description" property="description"/>
  <meta content="My Notes about using kedro" name="og:description" property="og:description"/>
  <meta content="My Notes about using kedro" name="twitter:description" property="twitter:description"/>
  <meta content="Kedro" name="og:title" property="og:title"/>
  <meta content="Kedro" name="twitter:title" property="twitter:title"/>
  <meta content="Kedro" name="title" property="title"/>
  <link href="/manifest.json" rel="manifest"/>
 </head>
 <body>
  <nav>
   <ul>
    <li>
     <a href="https://waylonwalker.com">
      Home
     </a>
    </li>
    <li>
     <a href="https://waylonwalker.com/archive">
      Archive
     </a>
    </li>
    <li>
     <a aria-label="RSS" href="https://waylonwalker.com/rss">
      <svg class="icon" height="16" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
       <path d="M 4 4.44 v 2.83 c 7.03 0 12.73 5.7 12.73 12.73 h 2.83 c 0 -8.59 -6.97 -15.56 -15.56 -15.56 Z m 0 5.66 v 2.83 c 3.9 0 7.07 3.17 7.07 7.07 h 2.83 c 0 -5.47 -4.43 -9.9 -9.9 -9.9 Z M 6.18 15.64 A 2.18 2.18 0 0 1 6.18 20 A 2.18 2.18 0 0 1 6.18 15.64" fill="currentColor">
       </path>
      </svg>
     </a>
    </li>
   </ul>
  </nav>
  <article class="blog-post h-entry">
   <h1>
    <a href="https://twitter.com/search?q=%23kedrotips&amp;f=live">
     #kedrotips
    </a>
   </h1>
   <p>
    I am tweeting out most of these snippets as I add them, you can find them all here
    <a href="https://twitter.com/search?q=%23kedrotips">
     #kedrotips
    </a>
    .
   </p>
   <h1>
    üó£ Heads up
   </h1>
   <p>
    Below are some quick snippets/notes for when using kedro to build data pipelines. So far I am just compiling snippets. Eventually I will create several posts on kedro. These are mostly things that I use In my everyday with kedro. Some are a bit more essoteric. Some are helpful when writing production code, some are useful more usefule for exploration.
   </p>
   <h2>
    üìö Catalog
   </h2>
   <p>
    <img alt="catalogs" src="/jesse-orrico-h6xNSDlgciU-unsplash.jpg"/>
    <em>
     Photo by jesse orrico on Unsplash
    </em>
   </p>
   <h3>
    CSVLocalDataSet
   </h3>
   <p>
    <strong>
     python
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">import pandas as pd
iris = pd.read_csv('https://raw.githubusercontent.com/quantumblacklabs/kedro/d3218bd89ce8d1148b1f79dfe589065f47037be6/kedro/template/%7B%7B%20cookiecutter.repo_name%20%7D%7D/data/01_raw/iris.csv')

data_set = CSVLocalDataSet(filepath="test.csv",
                                 load_args=None,
                                 save_args={"index": False})

iris_data_set.save(iris)
reloaded_iris = iris_data_set.load()</code></pre>
   <p>
    <strong>
     yaml
    </strong>
   </p>
   <pre class="highlight"><code class="language-yaml">test_data:
   type: CSVLocalDataset
   filepath: test.csv
   load_args: None
   save_args:
      index: False</code></pre>
   <h2>
    CSVHTTPDataSet
   </h2>
   <pre class="highlight"><code class="language-python">cities = CSVHTTPDataSet(
    fileurl="https://raw.githubusercontent.com/quantumblacklabs/kedro/d3218bd89ce8d1148b1f79dfe589065f47037be6/kedro/template/%7B%7B%20cookiecutter.repo_name%20%7D%7D/data/01_raw/iris.csv",
    auth=None,
    load_args=None)

iris = iris_data_set.load()</code></pre>
   <pre class="highlight"><code class="language-yaml">cities:
   type: CSVHTTPDataSet
    fileurl: https://people.sc.fsu.edu/~jburkardt/data/csv/cities.csv
    auth: None
    load_args: None</code></pre>
   <h2>
    HDFLocalDataSet
   </h2>
   <pre class="highlight"><code class="language-python">import pandas as pd
from kedro.io import HDFLocalDataSet

iris = pd.read_csv('https://raw.githubusercontent.com/quantumblacklabs/kedro/d3218bd89ce8d1148b1f79dfe589065f47037be6/kedro/template/%7B%7B%20cookiecutter.repo_name%20%7D%7D/data/01_raw/iris.csv')
iris_data_set = HDFLocalDataSet(filepath="iris.hdf",
                           key="test_hdf_key",
                           load_args=None,
                           save_args=None)

iris_data_set.save(iris)
reloaded_iris = iris_data_set.load()</code></pre>
   <pre class="highlight"><code class="language-yaml">cars:
   type: HDFLocalDataSet
   filepath: test.hdf
   key: test_hdf_key</code></pre>
   <h2>
    HDFS3LocalDataSet
   </h2>
   <pre class="highlight"><code class="language-python">import pandas as pd
from kedro.io import HDFS3DataSet

iris = pd.read_csv('https://raw.githubusercontent.com/quantumblacklabs/kedro/d3218bd89ce8d1148b1f79dfe589065f47037be6/kedro/template/%7B%7B%20cookiecutter.repo_name%20%7D%7D/data/01_raw/iris.csv')
iris_data_set = HDFS3DataSet(filepath="iris.hdf",
                        bucket_name="bucket-us-west-1",
                        key="test_hdf_key",
                        load_args=None,
                        save_args=None)

iris_data_set.save(iris)
reloaded_iris = iris_data_set.load()</code></pre>
   <pre class="highlight"><code class="language-yaml">cars:
   type: HDFS3DataSet
   filepath: cars.hdf
   bucket_name: bucket-us-west-1
   key: test_hdf_key</code></pre>
   <h2>
    JSONLocalDataSet
   </h2>
   <pre class="highlight"><code class="language-python">import pandas as pd
from kedro.io import JSONLocalDataSet

iris = pd.read_csv('https://raw.githubusercontent.com/quantumblacklabs/kedro/d3218bd89ce8d1148b1f79dfe589065f47037be6/kedro/template/%7B%7B%20cookiecutter.repo_name%20%7D%7D/data/01_raw/iris.csv')
cars = JSONLocalDataSet(filepath="iris.json",
                        load_args=None,
                        save_args=None)

iris_data_set.save(iris)
reloaded_iris = iris_data_set.load()</code></pre>
   <pre class="highlight"><code class="language-yaml">cars:
   type: JSONLocalDataSet
   filepath: iris.json</code></pre>
   <h2>
    ParquetLocalDataSet
   </h2>
   <pre class="highlight"><code class="language-python">import pandas as pd
from kedro.io import ParquetLocalDataSet

iris = pd.read_csv('https://raw.githubusercontent.com/quantumblacklabs/kedro/d3218bd89ce8d1148b1f79dfe589065f47037be6/kedro/template/%7B%7B%20cookiecutter.repo_name%20%7D%7D/data/01_raw/iris.csv')

iris_data_set = ParquetLocalDataSet('iris',
                           engine='auto',
                           load_args=None,
                           save_args=None,
                           version=None)

iris_data_set.save(iris)
reloaded_iris = iris_data_set.load()</code></pre>
   <pre class="highlight"><code class="language-yaml">cars:
   type: JSONLocalDataSet
   filepath: cars</code></pre>
   <p>
    PickleS3DataSet
   </p>
   <p>
    SQLTableDataSet
   </p>
   <p>
    SQLQueryDataSet
   </p>
   <p>
    TextLocalDataSet
   </p>
   <p>
    ExcelLocalDataSet
   </p>
   <h2>
    ‚è≥ Loading Data
   </h2>
   <p>
    <img alt="loading data" src="/battlecreek-coffee-roasters-eg6OUchGCsw-unsplash.jpg"/>
    <em>
     Photo by Battlecreek Coffee Roasters on Unsplash
    </em>
   </p>
   <h3>
    Simple Loading
   </h3>
   <pre class="highlight"><code class="language-python">df = catalog.load('cars')</code></pre>
   <h3>
    list all datasets
   </h3>
   <pre class="highlight"><code class="language-python">catalog.list()</code></pre>
   <h3>
    Saving Data
   </h3>
   <pre class="highlight"><code class="language-python">catalog.save('cars', cars)</code></pre>
   <h3>
    üîç Finding data
   </h3>
   <p>
    <strong>
     simple keyword search
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">query = 'raw'
[data for data in catalog.list() if query in data]</code></pre>
   <p>
    <em>
     see on
    </em>
    <a href="https://twitter.com/_WaylonWalker/status/1197130980659732480?s=20">
     <em>
      #kedrotips
     </em>
    </a>
   </p>
   <p>
    <strong>
     multi keyword serch
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">query = 'raw sales'
data_sets = catalog.list()
for word in query.split():
    data_sets = [
       data
       for data in data_sets
       if query in data
       ]</code></pre>
   <p>
    <em>
     see on
    </em>
    <a href="https://twitter.com/_WaylonWalker/status/1197528461587419139?s=20">
     <em>
      #kedrotips
     </em>
    </a>
   </p>
   <p>
    <strong>
     üêí monkey patch it
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">def query(*search_terms):
     data_sets = catalog.list()
     for search in search_terms:
         data_sets = [
         data
         for data in data_sets
         if search in data
         ]
     return data_sets

catalog.query = query</code></pre>
   <p>
    _see on
    <a href="https://twitter.com/_WaylonWalker/status/1197855759507300352?s=20">
     #kedrotips
    </a>
   </p>
   <h3>
    ü§ô YOLO
   </h3>
   <p>
    <em>
     You Only Load Once
    </em>
   </p>
   <p>
    <strong>
     simple
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">data = [catalog.load(d)
        for d in
        catalog.query('c_pri', 'cars')
        ]</code></pre>
   <p>
    <strong>
     more refined
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">data = {
   d: catalog.load(d)
   for d in catalog.query('c_pri', 'cars')
   }</code></pre>
   <p>
    <strong>
     üç∑ refined like a fine wine
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">from types import SimpleNamespace
data = SimpleNamespace**{
   d: catalog.load(d)
   for d in catalog.query('c_pri', 'cars')
   })</code></pre>
   <p>
    <strong>
     üßÄ Make it a function
    </strong>
    <em>
     getting funcy
    </em>
   </p>
   <pre class="highlight"><code class="language-python">from types import SimpleNamespace

def yolo(*search_terms):
   """you only load once
   using query method from previous tip"""
   data = SimpleNamespace(**{
       d: catalog.load(d)
   for d in catalog.query(*search_terms)
    })
    return data

all_pri = yolo('c_pri')</code></pre>
   <p>
    <strong>
     üêí monkey patch it
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">from functools import partial

catalog.yolo = yolo
catalog.yolo.__doc__ = "you only load once"

all_pri = catalog.yolo('c_pri')</code></pre>
   <h3>
    adding catalogs together
   </h3>
   <pre class="highlight"><code class="language-python">from kedro.io import DataCatalog
DataCatalog({**cat1.__dict__['_data_sets'], **cat2.__dict__['_data_sets']})</code></pre>
   <h2>
    üõ¢ Building pipelines
   </h2>
   <p>
    <img alt="building pipelines" src="/roman-pentin-T5QT2bmiD4E-unsplash.jpg"/>
    <em>
     Photo by roman pentin on Unsplash
    </em>
   </p>
   <h3>
    üìç Creating Nodes
   </h3>
   <pre class="highlight"><code class="language-python">from kedro.pipeline import node
node = node(lambda x: x.dropna(), inputs='raw_cars', outputs='int_cars')</code></pre>
   <pre class="highlight"><code class="language-python">from kedro.pipeline import node

def drop_columns(df, *columns):
   for column in columns:
      df = df.drop(columns=column)
   return df

node = node(
   lambda x: drop_columns(x, 'vs', 'am', 'gear', 'carb'),
   inputs='int_cars',
   outputs='pri_cars'
   )</code></pre>
   <h3>
    üõ¢ Creating a pipeline
   </h3>
   <h3>
    Don't be so verbose
   </h3>
   <p>
    Create similar nodes dynamically
   </p>
   <pre class="highlight"><code class="language-python">def halve_dataframe(data: pd.DataFrame) -&gt; List[pd.DataFrame]:
   """ splits a dataframe in half """
    return np.array_split(data, 2)

nodes = []
datasets = [
   'cars', 'trucks', 'boats', 'motorcycles', 'planes',
   'ships', 'busses', 'trains', 'subways'
   ]

# creates a pipeline node for every dataset in the datasets list
for dataset in datasets
   nodes.append(
       node(halve_dataframe,
            'e_modin_{dataset}',
            ['train_{dataset}', 'test_{dataset}']),
   )</code></pre>
   <h2>
    üèÉ‚Äç‚ôÇÔ∏è Running Pipelines
   </h2>
   <p>
    <img alt="running pipelines" src="/rodion-kutsaev-xNdPWGJ6UCQ-unsplash.jpg"/>
    <em>
     Photo by Rodion Kutsaev on Unsplash
    </em>
   </p>
   <p>
    <strong>
     üîñ filter by tags
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">nodes = pipeline.only_nodes_with_tags('cars')</code></pre>
   <p>
    <em>
     see on
    </em>
    <a href="https://twitter.com/_WaylonWalker/status/1195319044808888321?s=20">
     <em>
      #kedrotips
     </em>
    </a>
   </p>
   <p>
    <strong>
     filter by node
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">nodes = pipeline.only_nodes('b_int_cars')</code></pre>
   <p>
    _see on
    <a href="https://twitter.com/_WaylonWalker/status/1196406204479737856?s=20">
     #kedrotips
    </a>
   </p>
   <p>
    <strong>
     filter nodes like
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">query_string = 'cars'
nodes = [
   node.name
   for node in pipeline.nodes
   if query_string in node.name
   ]
pipeline.only_nodes(*nodes)</code></pre>
   <p>
    <em>
     see on
    </em>
    <a href="https://twitter.com/_WaylonWalker/status/1196813895228428288?s=20">
     <em>
      #kedrotips
     </em>
    </a>
   </p>
   <p>
    <strong>
     only nodes with tags
    </strong>
    <em>
     or
    </em>
   </p>
   <pre class="highlight"><code class="language-python">nodes = pipeline.only_nodes_with_tags('cars', 'trains')</code></pre>
   <p>
    <strong>
     only nodes with tags
    </strong>
    <em>
     and
    </em>
   </p>
   <pre class="highlight"><code class="language-python">raw_nodes = pipeline.only_nodes_with_tags('raw')
car_nodes = pipeline.only_nodes_with_tags('cars')
raw_car_nodes = raw_nodes &amp; car_nodes</code></pre>
   <pre class="highlight"><code class="language-python">raw_nodes = (
   pipeline
   .only_nodes_with_tags('raw')
   .only_nodes_with_tags('cars')
   )</code></pre>
   <p>
    <strong>
     add pipelines
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">car_nodes = pipeline.only_nodes_with_tags('cars')
train_nodes = pipeline.only_nodes_with_tags('trains')
transportation_nodes = car_nodes + train_nodes</code></pre>
   <p>
    <strong>
     ensure nodes are attached
    </strong>
   </p>
   <pre class="highlight"><code class="language-python">cars_attached = len(
   pipeline
   .only_nodes_with_tags('cars')
   .grouped_nodes
   ) == 1</code></pre>
   <h3>
    üéÇ Pipeline Decorators
   </h3>
   <p>
    <a href="https://kedro.readthedocs.io/en/latest/_modules/kedro/pipeline/decorators.html#log_time">
     example - log_time
    </a>
   </p>
   <pre class="highlight"><code class="language-python">from kedro.pipeline.decorators import log_time, mem_profile
pipeline.decorate(log_running_time)</code></pre>
   <h2>
    Pipeline IO
   </h2>
   <p>
    <code>
     pipleine.all_inputs()
    </code>
    and
    <code>
     pipeline.all_outputs()
    </code>
    return sets of pipeline inputs and outputs and you can do set operations on them.  This is particularly useful to find the upper and lower edges of your pipeline or subset of pipeline.  The pipeline object here is any
    <code>
     kedro
    </code>
    pipeline including a filtered subset.
   </p>
   <h3>
    Find all raw data
   </h3>
   <pre class="highlight"><code class="language-python">pipeline.all_inputs() - pipeline.all_outputs()</code></pre>
   <h3>
    Find all final data
   </h3>
   <pre class="highlight"><code class="language-python">pipeline.all_outputs() - pipeline.all_inputs()</code></pre>
   <h3>
    Find all nodes that do not raw
   </h3>
   <p>
    This one is probably one that is pushing the limits of what I would do in a list comprehension that I use in prod or even put into a text editor, but I commonly use ipython for my adhoc work and keeping it all in one line is very handy.  Complex list comprehensions kinda start becoming like regex in a way that they are really easy to write and really hard to read.  I don't think this one quite hits that point but its getting close.
   </p>
   <p>
    I find this one super useful to help me either move data beween environments, or avoid unnecessary database calls.
   </p>
   <pre class="highlight"><code class="language-python">raw_inputs = pipeline.all_inputs() - pipeline.all_outputs()
raw_nodes = [node for node in pipeline.nodes if [i for i in raw_inputs if i in set(node.inputs)] != []]</code></pre>
   <div id="show">
   </div>
  </article>
 </body>
 <script>
  if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      // registration failed :(
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
 </script>
</html>
<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /> -->
  <meta content="width=device-width" name="viewport"/>
  <link href="/8bitcc_48x.png" rel="icon" type="image/png"/>
  <meta content="$ilp.uphold.com/MGN2ni2YMXaQ" name="monetization" property="monetization"/>
  <link href="/furo-purge.css" rel="stylesheet"/>
  <link href="/monokai.css" rel="stylesheet"/>
  <link href="/archive-styles.css" rel="stylesheet"/>
  <title>
   pre-commit is awesome
  </title>
  <meta content="article" name="og:type" property="og:type"/>
  <meta content="Waylon Walker" name="og:author" property="og:author"/>
  <meta content="Waylon Walker" name="og:site_name" property="og:site_name"/>
  <meta content="I recently discovered the ‚ú® awesomeness that is pre-commit. I steered away from it for so long because it seemed like a big daunting thing to set up, but really it's easy. It will automatically run checks for you. In some cases, it will even automatically fix them for you. Out of the box, it will do things like automatically trim extra whitespace, fix file endings, and ensure file sizes are not too large for git." name="description" property="description"/>
  <meta content="I recently discovered the ‚ú® awesomeness that is pre-commit. I steered away from it for so long because it seemed like a big daunting thing to set up, but really it's easy. It will automatically run checks for you. In some cases, it will even automatically fix them for you. Out of the box, it will do things like automatically trim extra whitespace, fix file endings, and ensure file sizes are not too large for git." name="og:description" property="og:description"/>
  <meta content="I recently discovered the ‚ú® awesomeness that is pre-commit. I steered away from it for so long because it seemed like a big daunting thing to set up, but really it's easy. It will automatically run checks for you. In some cases, it will even automatically fix them for you. Out of the box, it will do things like automatically trim extra whitespace, fix file endings, and ensure file sizes are not too large for git." name="twitter:description" property="twitter:description"/>
  <meta content="pre-commit is awesome" name="og:title" property="og:title"/>
  <meta content="pre-commit is awesome" name="twitter:title" property="twitter:title"/>
  <meta content="pre-commit is awesome" name="title" property="title"/>
  <link href="/manifest.json" rel="manifest"/>
 </head>
 <body>
  <nav>
   <ul>
    <li>
     <a href="https://waylonwalker.com">
      Home
     </a>
    </li>
    <li>
     <a href="https://waylonwalker.com/archive">
      Archive
     </a>
    </li>
    <li>
     <a aria-label="RSS" href="https://waylonwalker.com/rss">
      <svg class="icon" height="16" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
       <path d="M 4 4.44 v 2.83 c 7.03 0 12.73 5.7 12.73 12.73 h 2.83 c 0 -8.59 -6.97 -15.56 -15.56 -15.56 Z m 0 5.66 v 2.83 c 3.9 0 7.07 3.17 7.07 7.07 h 2.83 c 0 -5.47 -4.43 -9.9 -9.9 -9.9 Z M 6.18 15.64 A 2.18 2.18 0 0 1 6.18 20 A 2.18 2.18 0 0 1 6.18 15.64" fill="currentColor">
       </path>
      </svg>
     </a>
    </li>
   </ul>
  </nav>
  <article class="blog-post h-entry">
   <p>
    I recently discovered the ‚ú® awesomeness that is pre-commit. I steered away from it for so long because it seemed like a big daunting thing to set up, but really it's easy. It will automatically run checks for you. In some cases, it will even automatically fix them for you. Out of the box, it will do things like automatically trim extra whitespace, fix file endings, and ensure file sizes are not too large for git.
   </p>
   <h2>
    Quickstart
   </h2>
   <p>
    It comes with a
    <code>
     sample-config
    </code>
    that is pretty general purpose and use for just about any project in git.
   </p>
   <pre class="highlight"><code class="language-bash">pip instal pre-commit
pre-commit sample-config &gt; .pre-commit-config.yaml
pre-commit install
git add .
git commit -m "added pre-commit"</code></pre>
   <h2>
    Cloned Repo
   </h2>
   <p>
    Once someone has created the
    <code>
     .pre-commit-config.yaml
    </code>
    everyone on the team will want to be running it for consistency's sake. (make sure everyone agrees with the config you have chosen first). Simply install the existing config.
   </p>
   <pre class="highlight"><code class="language-bash">pip install pre-commit
git clone &lt;repo&gt;
pre-commit install
git add .
git commit -m "added pre-commit"</code></pre>
   <h2>
    sample-config
   </h2>
   <p>
    The sample configuration does some really basic, file ending, trailing-whitespace fixing. And checks for files too large for git. This one saved me when I tried to commit linux
    <code>
     rpm
    </code>
    once ü§¶‚Äç‚ôÄÔ∏è.
   </p>
   <pre class="highlight"><code class="language-yaml"># See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
repos:
- repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v2.4.0
    hooks:
    - id: trailing-whitespace
    - id: end-of-file-fixer
    - id: check-yaml
    - id: check-added-large-files</code></pre>
   <h2>
    Adding some extras from pre-commit themselves
   </h2>
   <p>
    Here I have added a couple of extra ones form pre-commit
   </p>
   <pre class="highlight"><code class="language-yaml">    - id: check-case-conflict # Check for files that would conflict in case-insensitive filesystems
    - id: check-merge-conflict # Check for files that contain merge conflict strings.
    - id: debug-statements # Check for debugger imports and py37+ `breakpoint()` calls in python source.
    - id: requirements-txt-fixer # Sorts entries in requirements.txt
    - id: forbid-new-submodules # Check for git submodules
    - id: flake8 # runs python flake8</code></pre>
   <p>
    The submodules one is big. I have seen several folks trying to learn git for the first time mistakenly start nesting all of their projects underneath each other and eventually losing a lot of work. Trying to learn the command line and git all at once can be really confusing.
   </p>
   <h2>
    skip pre-commit
   </h2>
   <p>
    So you have a big codebase and you are trying to get pre-commit ready, but you just need your changes in.
   </p>
   <pre class="highlight"><code class="language-yaml">git commit -m "commiting wihout pre-commit" --no-verify</code></pre>
   <h2>
    manually run pre-commit
   </h2>
   <p>
    If you have an existing repo and want to run pre-commit on everything, since it was pre-existing, you can do that manually.
   </p>
   <pre class="highlight"><code class="language-yaml">pre-commit run --all-files</code></pre>
   <h2>
    So pre-commit changed some files
   </h2>
   <p>
    Since
    <code>
     pre-commit
    </code>
    only runs against staged files, but makes changes to the local files you need to add them.
   </p>
   <p>
    Here is a git status after committing with some trailing whitespace issues.
   </p>
   <pre class="highlight"><code class="language-bash">‚ùØ git status
On branch main
Changes to be committed:
  (use "git restore --staged &lt;file&gt;..." to unstage)
        modified: README.md

Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git restore &lt;file&gt;..." to discard changes in working directory)
        modified: README.md</code></pre>
   <p>
    <code>
     pre-commit
    </code>
    will keep yelling at you about
    <code>
     trailing whitespace
    </code>
    until you add the files.
   </p>
   <pre class="highlight"><code class="language-bash">git add README.md</code></pre>
   <h2>
    Community Developed plugins
   </h2>
   <p>
    <em>
     give me more
    </em>
   </p>
   <p>
    These almost make it
    <strong>
     too
    </strong>
    easy. Sharing your process to get up and running without
    <code>
     pre-commit
    </code>
    can involve a lot of instructions. Installing several different tools, then running them manually, probably forgetting to do so sometimes. These will automatically install and only run scoped to the files that have changed, not on the whole repo.
   </p>
   <h3>
    isort
   </h3>
   <pre class="highlight"><code class="language-yaml">- repo: https://github.com/asottile/seed-isort-config
rev: v2.1.1
hooks:
    - id: seed-isort-config
- repo: https://github.com/pre-commit/mirrors-isort
rev: v4.3.21
hooks:
    - id: isort</code></pre>
   <h3>
    .isort.cfg
   </h3>
   <p>
    In order to get isort to play nicely with black, I found great success with the following config placed in the root of the repo at
    <code>
     .isort.cfg
    </code>
    . Without these settings, I found that you commits will consistently fail checks because
    <code>
     isort
    </code>
    and
    <code>
     black
    </code>
    are fighting each other.
   </p>
   <pre class="highlight"><code class="language-toml">[settings]
multi_line_output=3
include_trailing_comma=True
force_grid_wrap=0
use_parentheses=True
line_length=88</code></pre>
   <h3>
    .flake8
   </h3>
   <p>
    Just as with
    <code>
     isort
    </code>
    flake8 tends to complain about a few things that black does. To get them to play nicely together place this file in the root of the repo at
    <code>
     .flake8
    </code>
    .
   </p>
   <pre class="highlight"><code class="language-toml"># taken from black
# added E231 as is conflicts with black formatting
[flake8]
ignore = E203, E266, E501, W503, E231, F541
max-line-length = 88
max-complexity = 18
select = B,C,E,F,W,T4,B9</code></pre>
   <h3>
    black
   </h3>
   <p>
    Black is an amazing CLI tool the python community has been blessed with. It was developed by python core dev Lukasz Langa after deep research of real python projects. It will autoformat your project and will check that the AST before and after remains the same ensuring that the code will run exactly the same. It only makes it more readable. I keep black installed and set to run on save. Many times I will bang out some sloppy code with long lines or poor indentation hit save and let black take care of the easy work.
   </p>
   <pre class="highlight"><code class="language-yaml">- repo: https://github.com/asottile/blacken-docs
    rev: v1.7.0
    hooks:
        - id: blacken-docs
        - additional_dependencies: [black]
- repo: https://github.com/psf/black
    rev: 19.3b0
    hooks:
        - id: black</code></pre>
   <h3>
    mypy
   </h3>
   <p>
    I have recently fallen in love with mypy. It has saved me from shipping some bugs that would not have been caught with tests, even with 100% coverage. I don't have 100% coverage across every possible type entered.
   </p>
   <pre class="highlight"><code class="language-yaml">    - repo: https://github.com/pre-commit/mirrors-mypy
      rev: v0.720
      hooks:
          - id: mypy
            exclude: tests/</code></pre>
   <h2>
    Your own plugin
   </h2>
   <p>
    Sometimes you have a CLI tool that you want to run, but there is no plugin. No worries, you can install manually set the repo to local, and add an entry for your CLI command to run.
   </p>
   <pre class="highlight"><code class="language-yaml">    - repo: local
      hooks:
          - id: interrogate
          name: "Interrogate docstring coverage check"
          types: [file, python]
          entry: interrogate -f 100 -vv</code></pre>
   <hr/>
   <p>
    I have been writing short snippets about my mentality breaking into the tech/data industry in my newsletter, üëá check it out and lets get the conversation started.
   </p>
   <p>
    <a href="https://waylonwalker.com/newsletter">
     <img alt="Sign up for my Newsletter" src="https://waylonwalker.com/waylon-walker-newsletter.png"/>
    </a>
   </p>
   <div id="show">
   </div>
  </article>
 </body>
 <script>
  if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      // registration failed :(
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
 </script>
</html>